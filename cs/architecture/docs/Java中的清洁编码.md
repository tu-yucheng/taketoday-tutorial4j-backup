## 1. 概述

在本教程中，我们将介绍干净的编码原则。我们还将了解为什么干净的代码很重要，以及如何在 Java 中实现这一点。此外，我们将看看是否有任何工具可以帮助我们解决问题。

## 2. 什么是整洁代码？

因此，在我们深入了解干净代码的细节之前，让我们了解一下干净代码的含义。老实说，对此没有一个好的答案。在编程中，一些关注点会相互影响并因此产生一般原则。但是，每种编程语言和范例都有自己的一组细微差别，这要求我们采用合适的做法。

从广义上讲，干净的代码可以概括为任何开发人员都可以轻松阅读和更改的代码。虽然这听起来像是对概念的过度简化，但我们将在本教程的后面部分看到它是如何构建的。每当我们听说干净的代码时，我们可能都会遇到一些对 Martin Fowler 的提及。以下是他在其中一个地方描述干净代码的方式：

>   任何傻瓜都可以编写计算机可以理解的代码。优秀的程序员编写人类可以理解的代码。

## 3. 我们为什么要关心干净的代码？

编写干净的代码既是个人习惯问题，也是技能问题。作为开发人员，我们随着时间的推移通过经验和知识不断成长。但是，我们必须问，到底为什么要投资开发干净的代码？我们知道其他人可能会更容易阅读我们的代码，但这种激励是否足够？让我们找出答案！

干净的编码原则帮助我们实现许多与我们打算生产的软件相关的理想目标。让我们通过它们来更好地理解它：

-   可维护的代码库：我们开发的任何软件都有生产寿命，在此期间需要更改和一般维护。干净的代码有助于开发易于随时间变化和维护的软件。
-   更轻松的故障排除：由于各种内部或外部因素，软件可能会出现意外行为。它可能经常需要在修复和可用性方面快速周转。使用简洁编码原则开发的软件更容易解决问题。
-   更快的入职：软件在其生命周期中会看到许多开发人员创建、更新和维护它，开发人员会在不同的时间点加入。这需要更快的入职培训以保持高生产力，而干净的代码有助于实现这一目标。

## 4. 简洁代码的特点

使用干净编码原则编写的代码库表现出几个使它们与众不同的特征。让我们来看看其中的一些特征：

-   专注：应该编写一段代码来解决特定的问题。它不应该做任何与解决给定问题严格无关的事情。这适用于代码库中的所有抽象级别，如方法、类、包或模块。
-   简单：这是干净代码最重要但经常被忽视的特征。软件的设计和实现必须尽可能简单，这样才能帮助我们达到预期的效果。代码库的复杂性增加使它们容易出错并且难以阅读和维护。
-   可测试：干净的代码虽然简单，但必须解决手头的问题。测试代码库必须直观且容易，最好以自动化方式进行。这有助于建立代码库的基线行为，并使其更容易在不破坏任何东西的情况下进行更改。

这些是帮助我们实现上一节中讨论的目标的因素。与以后重构相比，在开始开发时考虑到这些特征是有益的。这会降低软件生命周期的总拥有成本。

## 5. 干净的Java编码

现在我们已经了解了足够多的背景知识，让我们看看如何在 Java 中融入干净的编码原则。Java 提供了很多可以帮助我们编写干净代码的最佳实践。我们会将它们归类到不同的类别中，并了解如何使用代码示例编写干净的代码。

### 5.1. 项目结构

虽然 Java 不强制执行任何项目结构，但遵循一致的模式来组织我们的源文件、测试、配置、数据和其他代码工件总是有用的。Maven 是一种流行的 Java 构建工具，它[规定了特定的项目结构](http://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html)。虽然我们可能不使用 Maven，但坚持约定总是好的。

让我们看看 Maven 建议我们创建的一些文件夹：

-   src/main/java：用于源文件
-   src/main/resources：用于资源文件，如属性
-   src/test/java : 用于测试源文件
-   src/test/resources：用于测试资源文件，如属性

与此类似，还有[其他流行的项目结构，如 Bazel](https://www.baeldung.com/bazel-build-tool)建议用于 Java，我们应该根据我们的需要和受众选择一个。

### 5.2. 命名约定

遵循命名约定可以大大提高我们的代码的可读性和可维护性。Spring 的创造者 Rod Johnson 强调了Spring 中[命名约定的重要性](https://blog.atomist.com/eighteen-years-of-spring/)：

>   “......如果你知道某物的作用，你就有很大的机会猜测它的 Spring 类或接口的名称......”

在 Java 中命名任何东西时，Java[规定了一组要遵守的规则。](https://www.oracle.com/technetwork/java/codeconventions-135099.html)格式良好的名称不仅有助于阅读代码，而且还传达了很多有关代码意图的信息。让我们举一些例子：

-   类：就面向对象的概念而言，类是通常代表现实世界对象的对象的蓝图。因此，使用名词来命名充分描述它们的类是有意义的：

```java
public class Customer {
}复制
```

-   变量：Java 中的变量捕获从类创建的对象的状态。变量的名称应该清楚地描述变量的意图：

```java
public class Customer {
    private String customerName;
}复制
```

-   方法：Java 中的方法始终是类的一部分，因此通常表示对从类创建的对象的状态的操作。因此，[使用动词命名方法很有用](https://www.baeldung.com/java-pojo-class#javabeans)：

```java
public class Customer {
    private String customerName;
    public String getCustomerName() {
        return this.customerName;
    }
}复制
```

虽然我们只讨论了如何在 Java 中命名标识符，但请注意还有其他最佳实践，例如驼峰式大小写，我们应该遵守它们以提高可读性。还可以有更多与命名接口、枚举、常量相关的约定。

### 5.3. 源文件结构

源文件可以包含不同的元素。虽然 Java编译器强制执行某些结构，但很大一部分是流动的。但是坚持在源文件中放置元素的特定顺序可以显着提高代码的可读性。有多种流行的样式指南可以从中汲取灵感，例如[Google的一个和](https://google.github.io/styleguide/javaguide.html)[Spring](https://github.com/spring-projects/spring-framework/wiki/Code-Style)的另一个。

让我们看看源文件中元素的典型排序应该是怎样的：

-   包装声明
-   进口报表
    -   所有静态导入
    -   所有非静态导入
-   恰好是一个顶级类
    -   类变量
    -   实例变量
    -   构造器
    -   方法

除了上述之外，还可以根据方法的功能或范围对方法进行分组。没有一个好的惯例，这个想法应该一次决定，然后始终如一地遵循。

让我们看一个格式正确的源文件：

```java
# /src/main/java/com/baeldung/application/entity/Customer.java
package com.baeldung.application.entity;

import java.util.Date;

public class Customer {
    private String customerName;
    private Date joiningDate;
    public Customer(String customerName) {
        this.customerName = customerName;
        this.joiningDate = new Date();
    }

    public String getCustomerName() { 
        return this.customerName; 
    }

    public Date getJoiningDate() {
        return this.joiningDate;
    }
}复制
```

### 5.4. 空格

我们都知道，与大块文本相比，短段落更容易阅读和理解。在阅读代码方面也没有太大区别。适当放置和一致的空格和空行可以增强代码的可读性。

这里的想法是在代码中引入逻辑分组，这有助于在尝试通读代码时组织思维过程。这里没有单一的规则可以采用，而是一套通用的指导方针和将可读性置于其中心的内在意图：

-   开始静态块、字段、构造函数和内部类之前的两个空行
-   多行方法签名后的一个空行
-   将保留关键字(如 if、for、catch)与左括号分隔开的单个空格
-   一个单独的空格分隔保留关键字，如 else，从右括号中捕获

这里的清单并不详尽，但应该给我们一个前进的方向。

### 5.5. 缩进

尽管非常微不足道，但几乎所有开发人员都会保证这样一个事实，即缩进良好的代码更易于阅读和理解。Java 中的代码缩进没有单一的约定。这里的关键是要么采用一种流行的惯例，要么定义一个私有的惯例，然后在整个组织中始终如一地遵循它。

让我们看看一些重要的缩进标准：

-   一个典型的最佳实践是使用四个空格，一个缩进单位。请注意，某些指南建议使用制表符而不是空格。虽然这里没有绝对的最佳实践，但关键仍然是一致性！
-   通常情况下，行长度应该有一个上限，但由于当今开发人员使用的屏幕更大，因此可以将其设置为高于传统的 80。
-   最后，由于许多表达式无法放在一行中，因此我们必须一致地中断它们：
    -   在逗号后中断方法调用
    -   在运算符之前中断表达式
    -   缩进换行以获得更好的可读性(我们在 Baeldung 更喜欢两个空格)

让我们看一个例子：

```java
List<String> customerIds = customer.stream()
  .map(customer -> customer.getCustomerId())
  .collect(Collectors.toCollection(ArrayList::new));复制
```

### 5.6. 方法参数

参数对于方法按规范工作至关重要。但是，一长串参数会让人难以阅读和理解代码。那么，我们应该在哪里划清界限呢？让我们了解可能对我们有帮助的最佳实践：

-   尽量限制一个方法接受的参数个数，三个参数一个不错的选择
-   如果需要的参数超过推荐的参数，请考虑[重构该方法，通常一个长参数列表也表明该方法可能正在做多项事情](https://www.baeldung.com/cs/refactoring)
-   我们可以考虑将参数捆绑到自定义类型中，但必须注意不要将不相关的参数转储到单一类型中
-   最后，虽然我们应该使用这个建议来判断代码的可读性，但我们不能对此迂腐

让我们看一个例子：

```java
public boolean setCustomerAddress(String firstName, String lastName, String streetAddress, 
  String city, String zipCode, String state, String country, String phoneNumber) {
}

// This can be refactored as below to increase readability

public boolean setCustomerAddress(Address address) {
}复制
```

### 5.7. 硬编码

代码中的硬编码值通常会导致多种副作用。例如，它会导致重复，使改变变得更加困难。如果值需要是动态的，它通常会导致不良行为。在大多数情况下，可以通过以下方式之一重构硬编码值：

-   考虑用 Java 中定义的常量或枚举替换
-   否则，替换为在类级别或单独的类文件中定义的常量
-   如果可能，替换为可以从配置或环境中选择的值

让我们看一个例子：

```java
private int storeClosureDay = 7;

// This can be refactored to use a constant from Java

private int storeClosureDay = DayOfWeek.SUNDAY.getValue()复制
```

同样，没有严格的指导方针可以遵守。但是我们必须认识到，有些人以后需要阅读和维护这些代码。我们应该选择一个适合我们的约定并保持一致。

### 5.8. 代码注释

在阅读代码以理解重要方面时，[代码注释](https://www.baeldung.com/cs/clean-code-comments)可能是有益的。同时注意不要在注释中包含明显的东西。这会使注释膨胀，使相关部分难以阅读。

Java 允许两种类型的注释：实现注释和文档注释。它们也有不同的目的和不同的格式。让我们更好地理解它们：

-   文档/JavaDoc 注释
    -   这里的观众是代码库的用户
    -   这里的细节通常是免费实现的，更侧重于规范
    -   通常独立于代码库有用
-   实施/阻止评论
    -   这里的观众是在代码库上工作的开发人员
    -   这里的细节是特定于实现的
    -   通常与代码库一起使用

那么，我们应该如何最佳地使用它们，使它们有用且与上下文相关？

-   注释应该只是对代码的补充，如果没有注释我们无法理解代码，也许我们需要重构它
-   我们应该很少使用块注释，可能是为了描述重要的设计决策
-   我们应该为我们的大部分类、接口、公共和受保护方法使用 JavaDoc 注释
-   所有注释都应格式正确，并带有适当的缩进以提高可读性

让我们看一个有意义的文档注释的例子：

```java
/**
* This method is intended to add a new address for the customer.
* However do note that it only allows a single address per zip
* code. Hence, this will override any previous address with the
* same postal code.
*
* @param address an address to be added for an existing customer
*/
/*
* This method makes use of the custom implementation of equals 
* method to avoid duplication of an address with same zip code.
*/
public addCustomerAddress(Address address) {
}复制
```

### 5.9. 记录

任何曾经接触过生产代码进行调试的人都渴望在某个时间点获得更多日志。日志的重要性在一般的开发和特别的维护中怎么强调都不为过。

Java 中有很多用于日志记录的库和框架，包括 SLF4J、Logback。虽然它们使代码库中的日志记录变得非常微不足道，但必须注意日志记录的最佳实践。以其他方式完成的日志记录可能被证明是一场维护噩梦，而不是任何帮助。让我们来看看其中一些最佳实践：

-   避免过多的日志记录，考虑哪些信息可能有助于故障排除
-   明智地选择日志级别，我们可能希望在生产中有选择地启用日志级别
-   日志消息中的上下文数据非常清晰和描述性
-   使用外部工具跟踪、聚合、过滤日志消息以加快分析速度

让我们看一个正确级别的描述性日志记录示例：

```java
logger.info(String.format("A new customer has been created with customer Id: %s", id));复制
```

## 6.就这些了吗？

虽然上一节强调了几种代码格式约定，但这些并不是我们应该了解和关心的唯一约定。可读和可维护的代码可以受益于随着时间的推移积累的大量额外的最佳实践。

随着时间的推移，我们可能会遇到它们作为有趣的首字母缩略词。他们本质上将所学知识捕捉为一个或一组原则，可以帮助我们编写更好的代码。但是，请注意，我们不应该仅仅因为它们存在就遵循所有这些。大多数时候，它们提供的好处与代码库的大小和复杂性成正比。在采用任何原则之前，我们必须访问我们的代码库。更重要的是，我们必须与他们保持一致。

### 6.1. 坚硬的

SOLID 是一个助记的首字母缩略词，它借鉴了[它为编写可理解和可维护的软件而提出的五个原则](https://www.baeldung.com/solid-principles)：

-   单一职责原则：我们定义的每个接口、类或方法都应该有一个明确定义的目标。从本质上讲，它应该理想地做一件事并且把它做好。这有效地导致了更小的方法和类，它们也是可测试的。
-   开闭原则：理想情况下，我们编写的代码应该对扩展开放，对修改关闭。这实际上意味着一个类应该以不需要修改的方式编写。但是，它应该允许通过继承或组合进行更改。
-   [Liskov 替换原则](https://www.baeldung.com/cs/liskov-substitution-principle)：这个原则说明的是每个子类或派生类都应该可以替换它们的父类或基类。这有助于减少代码库中的耦合，从而提高跨代码的可重用性。
-   接口隔离原则：实现接口是为我们的类提供特定行为的一种方式。但是，一个类必须不需要实现它不需要的方法。这需要我们做的是定义更小、更专注的接口。
-   依赖倒置原则：根据这个原则，类应该只依赖于抽象而不依赖于它们的具体实现。这实际上意味着类不应该负责为其依赖项创建实例。相反，应该将此类依赖项注入到类中。

### 6.2. 干燥和亲吻

DRY 代表“Don's Repeat Yourself”。该原则指出一段代码不应在整个软件中重复。该原则背后的基本原理是减少重复并提高可重用性。但是，请注意，我们在采用这个词时要小心，而不是过于字面意思。一些重复实际上可以提高代码的可读性和可维护性。

KISS 代表“保持简单，愚蠢”。这个原则表明我们应该尽量保持代码简单。随着时间的推移，这使得它易于理解和维护。遵循前面提到的一些原则，如果我们保持类和方法的重点和小，这将导致更简单的代码。

### 6.3. 测试驱动开发

TDD代表“测试驱动开发”。这是一种编程实践，要求我们[仅在自动化测试失败时才编写任何代码](https://www.baeldung.com/java-test-driven-list)。因此，我们必须从自动化测试的设计开发着手。在 Java 中，有几个框架可以编写自动化单元测试，例如 JUnit 和 TestNG。

这种做法的好处是巨大的。这导致软件始终按预期工作。因为我们总是从测试开始，所以我们逐渐地以小块的形式添加工作代码。此外，我们仅在新测试或任何旧测试失败时才添加代码。这意味着它也会导致可重用性。

## 7. 帮助工具

编写干净的代码不仅仅是原则和实践的问题，而是个人的习惯。随着我们的学习和适应，我们往往会成长为更好的开发人员。但是，为了在大型团队中保持一致性，我们还必须进行一些强制执行。代码审查一直是保持一致性并通过建设性反馈帮助开发人员成长的好工具。

但是，我们不一定要在代码审查期间手动验证所有这些原则和最佳实践。[来自 Java OffHeap 的](https://www.javaoffheap.com/2019/10/episode-47-microsoft-flexing-its-java-muscle-javafx-is-alive-and-well-and-would-you-approve-my-low-quality-pr.html)Freddy Guime 谈到了自动化一些质量检查的价值，最终代码质量始终达到一定的阈值。

Java 生态系统中有几种可用的工具，它们至少可以从代码审阅者那里承担其中的一些责任。让我们看看其中一些工具是什么：

-   代码格式化程序：大多数流行的 Java 代码编辑器，包括 Eclipse 和 IntelliJ，都允许自动代码格式化。我们可以使用默认格式规则，自定义它们，或者用自定义格式规则替换它们。这会处理很多结构代码约定。
-   静态分析工具：Java 有几种静态代码分析工具，包括[SonarQube](https://www.baeldung.com/sonar-qube)、[Checkstyle](https://www.baeldung.com/checkstyle-java)、[PMD](https://www.baeldung.com/pmd)和[SpotBugs](https://spotbugs.github.io/)。他们有一套丰富的规则，可以按原样使用或为特定项目定制。它们非常擅长检测许多[代码味道](https://www.baeldung.com/cs/code-smells)，例如违反命名约定和资源泄漏。

## 八、总结

在本教程中，我们了解了干净编码原则的重要性以及干净代码所展现的特征。我们看到了如何在实践中采用其中一些原则，这些原则是用 Java 开发的。我们还讨论了其他有助于保持代码可读性和可维护性的最佳实践。最后，我们讨论了一些可用于帮助我们完成这项工作的工具。

总而言之，重要的是要注意所有这些原则和实践都是为了让我们的代码更简洁。这是一个更主观的术语，因此必须根据上下文进行评估。

虽然有许多规则可供采纳，但我们必须意识到自己的成熟度、文化和要求。我们可能必须定制或为此设计一套新的规则。但是，无论情况如何，重要的是在整个组织内保持一致以获得收益。
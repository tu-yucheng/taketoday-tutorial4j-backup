## 1. 概述

近年来，与 Subversion 等其他 SCM 系统相比， [Git 的](https://www.baeldung.com/cs/git-vs-svn) 受欢迎程度急剧上升。

随着 GitHub 和 GitLab 等免费平台的兴起，安全地对我们的应用程序代码进行版本控制和保存比以往任何时候都容易。

但不断输入凭据可能很麻烦，而且很难创建自动化的 CI/CD 管道。

在本教程中，我们将了解如何配置 Git 凭据以防止手动输入它们。

## 2.输入凭证

每当远程连接需要身份验证时，Git 都有多种方法来查找要使用的凭据。

让我们从基础开始，其中没有配置凭据。如果 Git 需要用户名和密码来访问远程连接，它会执行以下步骤来提示用户输入。

首先，它尝试调用允许用户输入凭据的应用程序。检查以下值(按顺序)以确定要使用的应用程序：

-   GIT_ASKPASS 环境变量
-   core.askPass 配置变量
-   SSH_ASKPASS 环境变量

设置这些中的任何一个都会调用应用程序，并且用户的输入会从其标准输出中读取

如果没有设置这些值，Git 将恢复为提示用户在命令行上输入。

## 3. 存储凭证

输入用户名和密码可能很乏味，尤其是在一天中频繁提交代码时。

手动输入密码很容易出错，也很难创建自动化管道。

为此，Git 提供了几种存储用户名和密码的方法。我们将在以下各节中介绍每种方式。

### 3.1. URL 中的用户名和密码

一些 Git 供应商允许在存储库 URL 中嵌入用户名和密码。这可以在我们克隆存储库时完成：

```bash
$ git clone https://<username>:<password>@gitlab.com/group/project.git复制
```

请记住，如果密码有特殊字符，则需要对它们进行转义以防止 shell 尝试解释它们。

或者，我们可以编辑存储库中的 Git 配置文件以包含用户名和密码：

```bash
url = https://<username>:<password>@<code class="language-shell">gitlab.com/group/project.git复制
```

我们还要注意，用户名和密码以纯文本形式存储，因此任何有权访问存储库的人都可以看到它们。

### 3.2. 凭据上下文

Git 还允许为每个上下文配置凭据。以下命令将配置特定的 Git 上下文以使用特定的用户名：

```bash
$ git config --global credential.https://github.com.username <your_username>复制
```

或者，我们可以直接编辑我们的全局 Git 配置文件。这通常位于我们的主目录中名为.gitconfig的文件中，我们将添加以下行：

```bash
[credential "https://github.com"]
	username = <username>复制
```

这种方法也不安全，因为用户名是以纯文本形式存储的。它还不允许存储密码，因此 Git 将继续提示它们。

## 4.凭证助手

Git 提供凭证助手来更安全地保存凭证。凭据助手可以以多种方式存储数据，甚至可以与密码钥匙串等第三方系统集成。

Git 开箱即用地提供了 2 个基本的凭证助手。缓存将凭据短期存储在内存中，存储将凭据无限期地存储在磁盘上。

让我们在接下来的部分中介绍每种方法。

### 4.1. 缓存凭证助手

以下是我们如何配置缓存凭证助手：

```bash
$ git config credential.helper cache复制
```

缓存凭据助手从不将凭据写入磁盘，尽管可以使用 Unix 套接字访问凭据。这些套接字使用仅限于存储它们的用户的文件权限进行保护，因此一般来说，它们是安全的。

我们还可以 在配置缓存凭证助手时提供超时参数。这使我们能够控制凭据在内存中保留多长时间：

```bash
$ git config credential.helper 'cache --timeout=86400'复制
```

这将在输入凭据后将其保存在内存中 1 天。

### 4.2. 存储凭证助手

存储凭据助手无限期地将凭据保存到文件中。

我们可以配置商店凭证助手：

```bash
$ git config credential.helper store复制
```

虽然文件内容未加密，但使用文件系统访问控制对创建文件的用户进行保护。

默认情况下，该文件存储在用户的主目录中。我们可以通过将文件 参数传递 给命令来覆盖文件位置：

```bash
$ git config credential.helper 'store --file=/full/path/to/.git_credentials'复制
```

### 4.3. 自定义凭证助手

除了上面的两个默认凭证助手之外，还可以配置[自定义助手](https://git-scm.com/docs/gitcredentials#_custom_helpers)。

这些使我们能够通过委托给第 3 方应用程序和服务来进行更复杂的凭证管理。

创建自定义凭证助手不是大多数用户需要担心的事情。

但是，它们有帮助的原因有几个：

-   与操作系统工具集成，例如 macOS 上的钥匙串
-   结合现有的企业身份验证方案，例如 LDAP 或 Active Directory
-   提供额外的安全机制，例如双因素身份验证

### 4.4. 从 Git 中删除缓存的凭证

Git 还允许我们轻松删除任何缓存的凭据。Git 凭据缓存运行一个守护进程，将我们的凭据缓存在内存中并按需分发。

让我们禁用 Git 凭证缓存：

```bash
$ git config --global --unset credential.helper复制
```

根据我们的初始配置级别，我们可以选择–global、–local和–system 选项。

如果我们不指定配置级别，则此命令默认为本地级别。

## 5.SSH密钥

大多数现代 Git 服务器使用 SSH 密钥而不是通过 HTTPS 的用户名和密码提供对存储库的访问。

SSH 密钥比密码更难猜测，而且如果它们遭到破坏，很容易被撤销。

使用 SSH 的主要缺点是它使用非标准端口。 某些网络或代理可能会阻止这些端口，从而无法与远程服务器进行通信。

它们还需要额外的步骤来在服务器和客户端上设置 SSH 密钥，这在大型组织中可能很麻烦。

为 Git 存储库启用 SSH 的最简单方法是在克隆它时使用 SSH 作为协议：

```bash
$ git clone git@gitlab.com:group/project.git复制
```

对于现有的存储库，我们可以使用以下命令更新远程：

```bash
$ git remote set-url origin git@gitlab.com:group/project.git复制
```

每个 Git 服务器的 SSH 密钥配置过程略有不同。

通常，它会在机器上生成兼容的公钥/私钥组合，并将公钥上传到你的 Git 服务器。

大多数 Unix/Linux 用户已经在他们的主目录中创建和配置了 SSH 密钥对，并上传了现有的公钥。我们永远不应该上传或以其他方式分享我们的私钥。

## 七、总结

在本教程中，我们了解了配置 Git 凭据的各种方法。最常见的方法是使用内置的凭据帮助程序将凭据本地存储在内存中或磁盘上的文件中。

一种更复杂、更安全的存储凭据的方法是使用 SSH，尽管这可能更复杂并且可能不适用于所有网络。
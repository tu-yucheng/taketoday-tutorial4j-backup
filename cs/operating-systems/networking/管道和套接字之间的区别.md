## 1. 概述

在本教程中，我们将讨论管道和套接字之间的区别。我们还将提供一些有关进程间通信 (IPC) 机制的信息，以及我们为什么首先需要它们。

## 2.IPC机制

由于[进程](https://www.baeldung.com/cs/process-vs-thread#1-some-specific-characteristics-of-processes)不共享相同的地址空间、栈和寄存器，我们需要使用[IPC](https://www.baeldung.com/cs/inter-process-communication)方法使进程协作。进程之间的通信方式不止一种。虽然管道和套接字是让我们有机会在进程之间进行通信的一些方法，但共享内存也是执行相同类型事情的其他方法之一。

所有这些机制都有其独特的功能，我们需要它们中的每一个来完成不同类型的任务。虽然共享内存是一个很好的解决方案，但当一个进程需要与在不同机器上工作的另一个进程通信时，我们可能需要其他解决方案，如管道和套接字。让我们在下一节中详细讨论它们。

## 3.管道

管道是使用最广泛的 IPC 方法之一。顾名思义，它是一个有两端的通道。当我们使用它的时候，它实际上使用了一块内核内存。系统调用管道总是创建管道和关联的文件描述符，fd[0]用于从管道读取，fd[1]用于写入管道。它将文件描述符的参数作为数组。我们可以看到下图我们是如何创建一个管道来两个进程之间通信的：

![管道 1](https://www.baeldung.com/wp-content/uploads/sites/4/2022/04/pipes-1.png)

### 3.1. 管道如何工作？

我们总是使用带有创建新进程的系统调用fork()的管道。正如我们猜测的那样，当我们只有一个进程时，使用管道是没有意义的。下图表示当我们不关闭不必要的文件描述符时，我们如何在父进程和子进程之间建立双向管道：

![管道已更新](https://www.baeldung.com/wp-content/uploads/sites/4/2022/04/pipeUPDATED-1024x512.png)

当我们关闭未使用的文件描述符时，我们将得到如下图。从下图中的正确版本可以看出，当我们使用pipe和fork时，父进程和子进程都可以读写管道。然而，由于管道是单向的，如果我们想要单向通信，我们应该小心。这意味着父母和孩子都可以互相发送数据。在那种情况下，一根管道将无法工作，这就是我们需要两根管道的原因。一根管道用于从父级到子级的数据流，一根用于数据从子级到父级的管道。我们还应该关闭不需要的管道描述符：

![管道3](https://www.baeldung.com/wp-content/uploads/sites/4/2022/04/pipes3-1024x476.png)

正如我们所说，管道是一种更适合相关进程的 IPC 方法。因为通信应该足够简单，可以使用原始二进制字节。实际上，我们在 shell 脚本中使用的管道是管道的最佳应用。他们所做的是，他们基本上执行二进制程序。所以，管道的局限性是显而易见的，我们只能将它应用到相关的进程中，并且我们可以进行一对一的通信。

对于更高级的IPC，当然还有[共享内存](https://www.baeldung.com/cs/inter-process-communication#1-shared-memory)、[消息队列](https://en.wikipedia.org/wiki/Message_queue)、套接字等其他方式。

## 4.套接字

套接字在当今的互联网中扮演着重要的角色。套接字一词最早出现在 1971 年的[RFC 147](https://datatracker.ietf.org/doc/html/rfc147)中，当时它被用于 ARPANET。它是网络中信息传输的唯一标识。今天套接字的现代实现来自 Berkeley 套接字。套接字与操作系统和进程直接相关，我们可以从起源于 Unix 操作系统的 Berkeley Software Distribution (BSD) 中的 Berkeley sockets 应用程序编程接口 (API) 了解这种情况。

网络协议栈的 API 为应用程序生成的每个套接字建立连接，这是一个套接字描述符。它就像类 Unix 操作系统中的文件描述符。该过程将其保存以用于通道上的读写操作。

### 4.1. 套接字如何工作？

网络套接字绑定到一种用于传输的网络协议的组合。此组合包括主机的网络地址和端口号。端口是节点上的编号资源，表示不同类型的软件结构。它们识别进程的服务类型并充当外部可访问的定位组件，允许其他主机连接到它们。我们可以使用网络套接字在两个节点之间建立永久连接或进行无连接和多播通信。

总而言之，使用套接字我们可以在甚至在不同机器上运行的进程之间建立连接。套接字 API 支持发送和接收操作，允许进程在内核级通信缓冲区内外共享消息缓冲区。

套接字调用允许我们创建内核级套接字缓冲区。此外，它将任何需要与套接字相关联的内核级处理与实际的消息移动相关联。正如我们所提到的，当我们使用套接字建立通信时，它可能发生在不同机器上的进程之间。

## 5. 管道和套接字的区别

我们已经解释了管道和套接字，并试图给出关于它们如何工作的直觉。正如我们所见，当我们试图在进程之间建立联系时，它们扮演着截然不同的角色。这真的取决于情况和问题，哪个更适合使用。但是，我们可以强调它们之间的一些区别：

-   管道通信是单向的，而套接字通信是双向的。
-   为了使用管道在进程之间建立通信，进程之间应该相互关联。他们应该有像父进程和子进程这样的关系。但是，我们对套接字没有这样的限制。
-   另一个重要的区别是我们可以使用管道连接同一台物理机器上的进程。另一方面，我们使用套接字在不同物理机器上的进程之间建立连接。这就是为什么它们是网络系统中的基本概念之一。
-   管道中没有任何包装的概念。套接字可以通过使用 IPv4 或 IPv6 的通信来拥有包。虽然套接字可以将大数据分成较小的块并以这种方式发送，但管道无法做到这一点。

## 六，总结

在本教程中，我们首先简要解释了为什么我们需要 IPC 机制，然后分享了 pipe 和 socket 的定义，它们是属于消息传递方法类别的 IPC 机制。之后，我们指出了管道和套接字之间的一些区别。

尽管我们在类 Unix 操作系统的范围内讨论这些 IPC 机制，但也可以在[Windows](https://docs.microsoft.com/en-us/windows/win32/ipc/interprocess-communications)中使用其中的一些机制。
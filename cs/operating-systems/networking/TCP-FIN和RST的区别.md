## 1. 概述

在我们的日常生活中，我们有几个信号来开始和结束与人的对话。 例如，我们可以与我们想与之交流的人握手。此外，我们可以友好地挥手向另一个人说再见，或者干脆背对着某人走开。

同样，计算机有不同的信号来协调网络中的通信。例如，如果计算机使用传输控制协议 (TCP) 进行通信，则 SYN、ACK、FIN 和 RST 消息充当这些通信信号。

在本教程中，我们将特别研究来自 TCP 的两个通信信号：FIN 和 RST。首先，我们将简要回顾 TCP 通信，指出用于开始和结束通信的消息。因此，我们将深入探讨 FIN 和 RST 消息，研究它们的使用场景。最后，我们将系统总结比较 FIN 和 RST。

## 2. TCP 通讯

[TCP](https://www.baeldung.com/cs/udp-vs-tcp#tcp)运行在[OSI 模型](https://www.baeldung.com/cs/osi-model)的第四层(传输层) 。因此，它为多个设备及其应用程序提供主机到主机的通信。此外，TCP 是一种面向连接的协议。这意味着通过 TCP 通信的设备必须建立连接。反过来，连接是通过[握手过程](https://www.baeldung.com/cs/handshakes)建立的，并使连接的设备能够交换消息。

为了建立、管理和关闭连接，TCP 使用充当设备信号的控制消息：

-   [SYN](https://www.baeldung.com/cs/tcp-protocol-syn-ack)：通常用于请求客户端和服务器之间的连接的同步消息
-   [ACK](https://www.baeldung.com/cs/tcp-protocol-syn-ack)：用于声明收到特定消息的确认消息
-   FIN：触发客户端和服务器之间正常连接终止的消息
-   RST：中止客户端和服务器之间的连接(强制终止)的消息

这样，典型的 TCP 通信以三次握手过程开始。此过程使用 SYN 和 ACK 消息在客户端和服务器之间建立连接。因此，连接的实体可以交换消息。

此外，实体相互确认(ACK)每个接收到的消息。当通信结束时，连接的实体发送 FIN 消息以关闭连接。于是，一个FIN握手过程开始了。但是，如果连接出现问题，实体可以通过发送 RST 消息中止它。

## 3.结束信息

FIN 消息优雅地请求终止 TCP 连接。 如果我们将连接比作对话，则 FIN 消息代表一个实体声明：“我已经说了我必须对你说的一切。现在，我会听你的，直到你把你要对我说的一切都说出来。” 然而，在技术术语中，FIN 消息会触发称为 FIN 握手的过程。 

让我们考虑客户端已经连接并与服务器通信。在某些时候，客户端发出信号以优雅地关闭连接。因此，FIN 握手开始：

1.  客户端向服务器发送FIN报文
2.  服务器收到客户端的FIN报文并ACK给客户端
3.  客户端收到服务器的ACK并等待
4.  如果有消息要从服务器发送给客户端，则由服务器发送
5.  服务器向客户端发送FIN报文
6.  客户端收到服务器的FIN报文并ACK给服务器
7.  服务端收到客户端的ACK，在服务端关闭连接
8.  客户端等待协议时间
9.  客户端在客户端关闭连接

下图描述了前面描述的 FIN 握手过程的步骤：

![结尾](https://www.baeldung.com/wp-content/uploads/sites/4/2021/11/FIN.png)

最后，需要强调的是，FIN 握手由一对双向握手组成：第一个由发送第一条 FIN 消息的实体发起(步骤 1)；第二个开始于另一个实体发送第二个 Fin 消息(步骤 5)。

## 4. RST消息

RST 消息中止 TCP 连接。 在我们的对话类比中，RST 消息相当于一个人声明：“我没有什么可谈的。我不会跟你说什么，也不会听你说什么。” 实际上，RST 消息使发送它的实体能够立即关闭 TCP 连接，从而忽略来自其他通信实体的任何后续消息。

让我们考虑客户端与服务器通信的一般场景。最终，服务器发生事件，无法响应客户端消息。因此，服务器必须通过 RST 消息通知客户端，如下所示：

1.  服务器向客户端发送RST消息
2.  服务器在服务器端关闭连接
3.  客户端收到服务器的RST报文
4.  客户端在客户端关闭连接

下图举例说明了先前概述的中止 TCP 连接的步骤：

![RST](https://www.baeldung.com/wp-content/uploads/sites/4/2021/11/RST.png)

可以使用 RST 消息的一些特定场景是：

-   一个实体通过先前建立的连接从另一个实体接收消息。然而，第一个实体已经关闭了它的套接字。因此，第一个实体向第二个实体发送 RST 消息
-   一个实体接收到一个已经建立的连接的 SYN 消息。因此，该实体使用 RST 消息响应 SYN 消息
-   一个实体收到另一个实体的消息，但第一个实体正忙，无法响应。因此，RST 消息从第一个实体发送到第二个实体

最后， 欺骗性 TCP 重置攻击 使用 RST 消息中止两个实体之间的连接。在这种情况下，恶意代理会伪造一个包含连接实体寻址信息的 RST 数据包。因此，这个恶意实体将伪造的数据包发送到那些连接的实体之一。

收到伪造数据包的实体立即中止连接。 在某些时候，另一个实体(没有收到伪造的数据包)注意到通信尝试没有得到响应，从而中止了连接。

## 5. FIN 与 RST

FIN 和 RST 消息在较高级别具有相同的目标：关闭 TCP 连接。然而，终止过程和使用这些消息的典型场景在多个方面有所不同。

首先，FIN 消息触发正常终止，使连接的实体同意关闭它们的连接。反过来，RST 消息会立即关闭连接，不需要其他连接实体的同意。

这样，有一些场景是用 FIN 或 RST 关闭连接是最合适的。一般来说，当 TCP 连接被认为是正常的(成功建立并且消息交换没有异常发生)时，FIN 消息是关闭它的更好选择。FIN 过程保证连接的实体发送和接收所有必需的消息。

反过来，在出现连接错误或实体收到异常消息时，中止与 RST 的连接是更好的选择。通过这种方式，RST 过程避免了灾难性错误和安全妥协的发生。

下表总结了 FIN 和 RST 之间的区别：

![由 QuickLaTeX.com 呈现](https://www.baeldung.com/wp-content/ql-cache/quicklatex.com-c55968fd5a9768efb1d273ccd82452d9_l3.svg)

## 六，总结

在这篇文章中，我们了解了TCP的FIN和RST消息关于TCP的FIN和RST消息关于TCP的FIN和RST消息。 首先，我们简要回顾了 TCP。然后，我们深入分析了FIN和RST的控制消息，概述了它们的特点。最后对比了FIN和RST的控制消息，总结了它们的主要区别和应用场景。

我们可以得出总结，FIN 和 RST 在 TCP 中发挥了相关作用，使实体能够在常见场景中协调关闭连接，或者在它们代表某些风险时中止它们。
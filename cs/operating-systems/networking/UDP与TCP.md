## 1. 概述

[用户数据报协议](https://www.baeldung.com/udp-in-java)(UDP) 和[传输控制协议](https://www.baeldung.com/a-guide-to-java-sockets)(TCP) 是计算机网络上最重要的两种数据传输协议。

在本教程中，我们将详细分析它们。然后，我们将比较它们并讨论关键差异。

## 2.UDP协议

### 2.1. 核心属性

David P. Reed 于 1980 年设计了 UDP 协议，并将其记录在[RFC 768](https://tools.ietf.org/html/rfc768)中。UDP 是一种[在 OSI 模型](https://www.baeldung.com/rest-vs-websockets#basics_of_network_communication)的传输层中工作的简单协议。应用程序可以使用 UDP 通过 Internet 协议将数据发送到其他主机。使用 UDP 发送的消息称为数据报。我们来分析一下UDP协议的核心属性。

首先，UDP协议是无连接的。简而言之，这意味着它缺少启动、维持或结束对话的机制。此外，没有任何流量控制或重传技术。因此，无法保证接收方将获得所有数据报或它们将以有效顺序到达。因此，UDP 有时被称为不可靠的传送协议。

UDP缺乏连接和可靠性机制是有特定原因的。无需在数据报中存储额外的安全数据字节。因此UDP传输轻量级、速度快。因此，UDP 通常用于传输速度至关重要的应用程序，例如在线游戏、视频会议或音乐流媒体软件。

此外，UDP 是无状态的并支持[多播](https://www.baeldung.com/java-broadcast-multicast)。因此，它是向大量主机发送消息的不错选择。它在流媒体应用程序中特别有用，例如 IPTV(互联网协议电视)或实时流媒体服务。正如我们前面提到的，使用 UDP 发送的数据报是轻量级的。在下一节中，我们将指定 UDP 的数据报结构。

### 2.2. 数据报组成

数据报是通过分组交换网络传输的独立的基本数据单元。数据报通常由标头和有效载荷组成。UDP 头包含四个字段，每个字段为 4 个字节。有效负载存储在主机之间传输的数据。下面详细分析一下数据报结构：

![由 QuickLaTeX.com 呈现](https://www.baeldung.com/wp-content/ql-cache/quicklatex.com-939cd7a12a1685a7a59f8e115dbd4104_l3.svg)

源端口号标识发送方主机的端口。使用时，它是一个端口，如果需要，应将回复发送到该端口。但是，该字段是可选的，如果不使用，其值为 0。

目标端口号标识接收方的端口，它是必填字段。

长度是一个字段，以字节为单位指定数据报的长度(其报头和有效负载)。标头的长度为 8 个字节。所以，它也是数据报的最小长度。理论上，单个数据报的最大长度为 65527 字节。但是，有一些方法可以扩展该限制，例如，使用 IPv6 [jumbograms](https://tools.ietf.org/html/rfc2675)。

最后，[校验和](https://www.baeldung.com/java-checksums)用于验证标头和有效载荷的正确性，它有 16 个字节长。它是 UDP 中检查数据报是否未损坏的唯一机制。虽然，校验和是一个可选字段。

## 3.TCP

与 UDP 类似，传输控制协议在 OSI 模型的传输层中运行，并在主机之间传输数据。但是，它的工作方式与用户数据报协议完全不同。TCP 协议规范于 1974 年在[RFC 675](https://tools.ietf.org/html/rfc675)中发布。让我们描述传输控制协议的核心概念。

首先，TCP 是面向连接的。简而言之，这意味着发送方和接收方必须建立连接并同意传输数据。为此，TCP 使用一种称为三向握手的技术。我们将在下一小节中详细描述它。

其次，传输控制协议是可靠的。它提供经过错误检查的有序数据流。传输的数据包可能会在协议栈的其他层中丢失。TCP 能够检测到此类问题。在这种情况下，它需要重新传输丢失的数据包。此外，它可以重新排列乱序的数据包。如果它无法完成或订购数据包，它会通知发件人有关问题，

第三，TCP传输是单播和双向的。这是所需的一对一握手的结果。TCP 无法处理多个主机。即使有可能实现，它也会使 TCP 过于复杂。因此，市场上没有任何基于多播 TCP 的解决方案。

总之，TCP 提供了可靠的、错误检查的和双向的传输。许多需要此类属性的互联网应用程序都使用 TCP，包括万维网、安全外壳、文件传输协议 (FTP) 等。

### 3.1. 连接建立

我们已经提到TCP使用三次握手机制来建立客户端和服务器之间的连接。下面，我们可以看到展示上述技术的流程图：

[![3路](https://www.baeldung.com/wp-content/uploads/sites/4/2020/10/3way.svg)](https://www.baeldung.com/wp-content/uploads/sites/4/2020/10/3way.svg)

该过程如下所示：

1.  同步。客户端通过向服务器发送 SYN 段来开始该过程。之前，它为段的序列号分配一个随机值(例如，100)。发送 SYN 后，客户端进入 SYN-SENT 状态。
2.  同步确认。服务器收到 SYN 段并进入 SYN-RECEIVED 状态。作为响应，它发送带有序列号(例如 300)的 SYN 段和 ACK 段。ACK 段的序列号值设置为客户端的序列号 + 1。在我们的示例中，它将是 101。
3.  客户端收到 SYN-ACK 并进入 ESTABLISHED 状态。它发回序列号设置为服务器序列号 + 1 的 ACK 段。在我们的示例中，它将是 301。服务器接收到 ACK 段并进入 ESTABLISHED 状态。最后，可以进行数据传输。

我们已经描述了在成功连接的情况下三向握手的工作原理。存在其中一台主机将关闭连接的情况。两台主机都可以启动连接关闭。这可以通过发送带有 FIN 标志的段来完成。FIN 请求必须由 ACK 段确认。但是，还有一个 RST 标志，可以在没有确认的情况下执行紧急关闭。

### 3.2. 数据包结构

 

![由 QuickLaTeX.com 呈现](https://www.baeldung.com/wp-content/ql-cache/quicklatex.com-a04441f7edf5ce964625676f23430ce1_l3.svg)

源端口标识发送方的端口，而目标端口标识接收方的端口。

序列号指定数据碎片整理之前文件在磁盘上的位置。因此，它允许将文件从各个数据包放在一起。

确认号确认另一台主机收到了数据包。

数据偏移量表示标头长度。它描述了 32 位长 header 的行数。因此，有必要确定数据的开头。

保留字段是为将来的最终目的保留的空间。因此，此刻充满了零。

标志提供有关数据包用途的信息。窗口大小告知主机愿意接收的数据大小，校验和验证数据完整性。

最后，紧急指针指示数据包中有多少数据被认为是紧急的，而选项字段(0-320 位，32 位的倍数)包含可能的附加选项和指令。为确保选项是 32 位的单位数据，必要时可以用零填充该字段。

## 4. UDP 与 TCP

到目前为止，我们已经详细分析了 UDP 和 TCP 协议。因此，综上所述，让我们将它们进行比较，看看它们的核心概念有何不同：

![由 QuickLaTeX.com 呈现](https://www.baeldung.com/wp-content/ql-cache/quicklatex.com-d05eacf6f9601694d8ce7aa3d76a2791_l3.svg)

## 5.总结

在本文中，我们详细讨论了 UDP 和 TCP 协议。首先，我们讨论了UDP的核心特性，分析了数据报的构建。然后，我们描述了 TCP 的关键属性。此外，我们描述了 TCP 的三次握手。接下来，我们描述了 TCP 的数据包格式。最后，我们比较了两种协议。
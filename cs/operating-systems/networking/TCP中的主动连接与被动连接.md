## 1. 概述

作为人类，我们有几种不同的方式来开始对话。但是，一般而言，任何对话都始于一个人展示他自己的谈话意图。反过来，另一个人会带着兴趣(或不感兴趣)返回进行对话，然后对话可以继续进行。

在网络中连接的机器之间启动连接的过程并没有太大不同。我们有多种协议可以使机器进行通信。其中一些非常直接地开始通信，例如UDP。其他的则需要握手过程，例如 TCP。

在 TCP 场景中，一台机器通过请求连接来引入。此过程涉及多个由相关机器主动触发和被动响应的任务。

在本教程中，我们将研究主动和被动机器在创建 TCP 连接中的作用。 首先，我们将简要回顾一下 TCP 连接。因此，我们将深入检查主动和被动机器在打开 TCP 连接时的动作。接下来，我们将看到由于被动/主动机器的错误操作而可能发生的连接打开问题。最后，我们以一个系统的总结来结束这篇文章。

## 2. TCP连接简述

[TCP](https://www.baeldung.com/cs/udp-vs-tcp#tcp) 是一种面向连接的协议。这意味着所涉及的机器必须在交换数据之前创建连接。打开 TCP 连接包括在启动的机器和等待通信的机器之间交换控制消息。

在 TCP 中，这个打开连接的过程由 [三次握手](https://www.baeldung.com/cs/handshakes)组成。总之，握手过程使用[SYN 和 ACK 消息](https://www.baeldung.com/cs/tcp-protocol-syn-ack)在 TCP 客户端和 TCP 服务器之间建立通信。

首先，服务器向服务器发送一个SYN报文。然后，如果服务器可用，它会用 SYN-ACK 响应客户端。因此，客户端通过向服务器发送 ACK 来确认 SYN-ACK。最后，建立连接，机器可以交换数据。

下图演示了三次握手过程：

![THW2](https://www.baeldung.com/wp-content/uploads/sites/4/2021/12/TWH2.png)

## 3.主动和被动开启TCP连接

客户端/服务器模型是 TCP/IP 的基础。这样，打开一个 TCP 连接包含了客户端和服务器的多个操作。下面描述客户端和服务器(或两者)在创建套接字后执行的相关操作：

-   Bind：将 IP 地址和端口号分配给套接字的操作。服务器端套接字必须显式绑定到地址和端口。但是，显式绑定客户端套接字是可选的
-   Listen：将服务器端套接字配置为连接模式的操作。例如，它定义了套接字在其侦听队列中将支持多少个连接
-   Accept：使服务器端套接字接受其连接队列中的第一个请求的操作。因此，它会触发在服务器端创建服务器和客户端之间的连接的过程
-   连接：在客户端执行的操作，它向给定的 TCP/IP 服务器发送连接请求

我们可以注意到在服务器端和客户端执行不同的操作以打开 TCP 连接。因此，我们可以假设客户端和服务器在此上下文中扮演不同的角色。这些不同的角色定义了主动或被动打开 TCP 连接：

-   Active：客户端负责主动打开 TCP 连接。这意味着客户端必须使用连接 操作主动向已知服务器(IP和端口)发送连接请求(SYN) 
-   被动：服务器负责被动打开 TCP 连接。因此，服务器使用接受 操作等待来自客户端的请求(SYN) 。要真正接受一个连接，服务器必须响应先前定义的 IP 和端口(绑定)并有插槽来保持新连接(侦听)

下图演示了主动和被动 TCP 连接的打开：

![主动被动](https://www.baeldung.com/wp-content/uploads/sites/4/2021/12/ActivePassive.png)

### 3.1. 传输控制块

无论是被动还是主动打开 TCP 连接，客户端和服务器都使用传输控制块 (TCB) 来保存有关连接的相关数据。

客户端的 TCB 非常简单。由于客户端已经知道自己的地址，主动创建连接必须知道服务器地址，所以可以直接通过这对地址定义TCB。

服务器端的 TCB 更复杂。由于服务器执行的是被动连接打开，因此有两种情况是可能的：服务器接受任何连接请求，或者服务器只接受特定客户端的连接请求。

在第一种情况下，服务器创建没有客户端地址或套接字号的 TCB。因此，当客户端主动请求连接时，此信息将绑定到 TCB。在第二种情况下，服务器已经知道客户端地址并且可以识别连接请求以仅接受预期的连接请求。

## 4.潜在的连接问题

打开 TCP 连接时可能会出现不同的问题。这些问题大多与 SYN 和 ACK 消息传输过程中的错误有关。让我们更多地了解其中的一些：

-   连接尝试失败：当发送或接收 SYN 数据包的套接字在连接期间进入不常见状态时，就会发生此问题。例如，当处于 SYN_SENT 状态(等待服务器的 SYN-ACK)的客户端收到 RST 消息时，它就会发生
-   收到坏段：当请求被损坏或欺骗时，这个问题会在几种情况下发生。例如，如果服务器收到一个可能是欺骗性的 SYN 请求，则将其理解为坏段，并采用挑战 ACK 缓解策略

## 五、系统总结

我们研究了 TCP 中的主动和被动连接打开。我们看到这些连接打开角色与基于 TCP/IP 的服务器/客户端模型有着内在的相关性。

总之，客户端负责主动请求与服务器的连接。连接 操作 通过向已知服务器地址(IP 和端口)发送 SYN 消息来触发此请求。

反过来，服务器被动地等待连接请求。它是通过执行操作accept来完成的。但是，在执行此操作之前，服务器必须绑定到一个地址并定义它将支持的连接数。

下表总结了 TCP 中主动和被动连接打开的特点：

![由 QuickLaTeX.com 呈现](https://www.baeldung.com/wp-content/ql-cache/quicklatex.com-d16b167e603405d1c8aa374cda626809_l3.svg)

## 六，总结

在本文中，我们了解了主动和被动 TCP 连接打开。首先，我们回顾了TCP协议，着重介绍了TCP连接的建立过程。于是，我们深入研究了主动和被动TCP连接打开的概念。我们还调查了 TCP 中潜在的连接问题。最后，我们系统地总结了所有研究过的概念。

我们可以得出总结，打开 TCP 连接的被动和主动角色完全符合基于 TCP 的客户端/服务器模型。通过这种方式，它成功地使多个客户端能够按需连接到可用的服务器，并随时执行他们的任务。
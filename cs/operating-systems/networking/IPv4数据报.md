## 1. 概述

[网际协议(IP)](https://www.baeldung.com/cs/popular-network-protocols#internet-protocol-ip)是网络层的通信协议。它的主要操作是路由。它将来自主机的数据包转发到目的地，一次一个路由器。

总之，传输层将数据流分解为 IP 数据包。然后，IP 路由器通过 Internet 转发这些数据包。在目的地，网络层将所有数据包重新组合成原始流。最后，传输层获取并处理数据。

互联网由不同的网络组成。这些网络的硬件支持不同的带宽。因此，有时，路由器必须在传输过程中将 IP 数据包分成更小的部分。这称为碎片化。

在本教程中，我们将详细讨论 IPv4 数据报。

## 2. IPv4数据报

[IPv4](https://www.baeldung.com/cs/ipv4-vs-ipv6#ipv4)于 1981 年开发，至今仍在广泛使用。它使用 32 位地址空间。

IPv4 数据包称为数据报。它由标题和数据部分组成：

![IPv4-1](https://www.baeldung.com/wp-content/uploads/sites/4/2021/09/IPv4-1.png)

IPv4 标头包含一个 20 字节的固定强制部分，后面是可选字段。因此，IPv4 标头的最小大小为 20 字节。

可选部分包含选项和填充。它的大小可以增长到 40 个字节。因此，最大标头大小为 60 字节。

一个数据报最多可以携带 65,535 个字节的数据 ( ![2^{16}](https://www.baeldung.com/wp-content/ql-cache/quicklatex.com-2b046eb9d1dd37dd97a8e4e952c67a42_l3.svg))，其中至少有 20 个字节是报头。因此，它携带的最大数据量为 65,515 字节。

标题部分包含 14 个字段。前 13 个是强制性的。最后一个是称为选项的可选字段。让我们看看各个标头字段。

### 2.1. 版本

IP 版本字段，对于 IPv4 设置为 4。

### 2.2. 互联网标头长度

IHL 是构成标题字段的 32 位字的数量。最小可用数量为 5，因为前 20 个字节是强制性的。

### 2.3. 差分服务代码点 (DSCP)

它指定区分服务的服务类型，例如 IP 语音。

### 2.4. 显式拥塞通知 (ECN)

如果支持，ECN 会在不丢包或浪费带宽的情况下携带网络拥塞通知。

### 2.5. 总长度

它是数据报的总大小，包括报头和数据部分。

### 2.6. 鉴别

如果数据报是分片的，它主要用于指示一组分片。

### 2.7. 旗帜

标志的不同组合控制碎片并指示碎片数据报。

我们假设当目的地无法组装分片数据包时设置了不分片标志。因此，如果标志将数据报标记为不分片，则数据包将被丢弃，但它必须分片。

### 2.8. 片段偏移

它包含分段数据包的偏移量。

### 2.9. 生存时间 (TTL)

数据包存在的跃点数。途中的每个路由器都会递减 TTL 字段。如果它达到 0，则丢弃数据包。这样，循环数据包就被消除了。

### 2.10. 协议

这是数据部分的协议。

### 2.11. 标头校验和

它是用于错误检测的校验和，仅覆盖标头字段。每个路由器检查此值并在检测到错误时丢弃数据包。
不计算数据部分的校验和。

### 2.12. 源地址

源主机 IPv4 地址。

### 2.13. 目的地地址

目标主机 IPv4 地址。

### 2.14. 选项

其他选项在存在时存储在该字段中。

## 3.总结

在本文中，我们了解了使用最广泛的网络通信协议。然后我们研究了数据报的结构。
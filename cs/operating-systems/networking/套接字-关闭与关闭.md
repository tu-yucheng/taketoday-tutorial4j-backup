## 1. 概述

套接字是在通用系统中启用进程间消息交换的通信端点。有几种操作可用于控制套接字的生命周期，例如：打开、绑定、发送、接收、 关闭和 关闭。

在本文中，我们将了解关闭和关闭之间的区别，同时了解每个操作的工作原理。

## 2. 套接字简述

套接字是为提供进程间通信而定制的网络软件。目前，核心网多采用TCP/IP模型构建。在此上下文中，套接字通常称为网络套接字或 Internet 套接字。我们强调通过套接字进行通信的进程可以在同一台机器(本地系统)或不同机器(分布式系统)中执行。

套接字处于应用层，采用 TCP/IP 模型。相对地，在 [OSI模型](https://www.baeldung.com/cs/osi-model)中，套接字位于会话层(第5层)。最后，三个类别可以定义一个网络套接字：

-   数据报：使用 [用户数据报协议](https://www.baeldung.com/cs/udp-vs-tcp) (UDP) 在没有任何连接的情况下进行进程通信的套接字。这样，数据报套接字既不保证可靠性也不保证进程间消息交换的顺序
-   Stream：使用[传输控制协议](https://www.baeldung.com/cs/udp-vs-tcp) (TCP) 启用面向连接的通信的套接字。因此，流套接字提供了不同进程之间顺序和无错误的消息交换
-   Raw：直接接收IP数据包的套接字，无论其传输层协议如何。通常，从原始套接字读取会返回带有显式标头的数据包。同样，原始套接字需要具有显式标头的数据包才能正确发送它们

## 3. 套接字实战

我们可以说，打开套接字实际上意味着创建一个启用全双工进程间通信的文件描述符。因此，通过套接字进行通信的进程读取文件描述符以接收数据包。同理，这些进程写入文件描述符发送数据包：

![套接字标准500](https://www.baeldung.com/wp-content/uploads/sites/4/2021/07/SocketStd500.png)

我们应该注意到，在某个时候，进程之间的通信可能会结束。

有两种操作可用于终止此通信：关闭和关闭。但是，可以以特定方式使用这些操作来实现不同的结果。接下来，我们将了解每一种操作的特殊性。

## 4.关机

关闭操作代表了一种在不破坏套接字的情况下阻止套接字通信的方法。但是，除了调用套接字关闭之外，还有必要定义此操作将如何执行。为此，可以使用三种执行模式：SHUT_RD、SHUT_WR 和 SHUT_RDWR。接下来描述这些执行模式。

SHUT_RD 模式阻止套接字进一步接收消息。因此，套接字缓冲区中包含的未决数据(即未传送)仍可由使用它的进程读取。但是，在读取未决数据之后，新的读取套接字的尝试将只返回零大小的消息。最后，我们强调执行关闭 SHUT_RD 操作不会禁用套接字的发送功能

SHUT_WR 模式阻止套接字发送消息。通常，套接字在关闭 SHUT_WR 操作之前完成所有挂起的消息发送请求。此外，作为关闭 SHUT_WR 执行的一部分，套接字通知连接的客户端(如果有的话)发送消息已暂停。最后，shutdown SHUT_WR操作不会阻塞接收消息的socket

SHUT_RDWR 模式阻止套接字发送和接收消息。与其他关闭模式类似，关闭 SHUT_RDWR 操作不会破坏套接字。因此，例如，流套接字的连接不会终止。但是，参与发送和接收操作的消息没有到达目的地。这种操作模式与顺序执行 SHUT_RD 和 SHUT_WR 关闭操作具有可比的结果

下图根据其执行模式总结了关闭操作的行为：

![SocketShutdown500](https://www.baeldung.com/wp-content/uploads/sites/4/2021/07/SocketShutdown500.png)

## 5.关闭

关闭操作会阻塞套接字的通信并将其销毁。换句话说，关闭套接字表示终止其连接(如果有的话)，然后关闭启用消息交换的文件描述符。这样，执行完close操作后，进程就不能读也不能写socket了。因此，任何对关闭的套接字进行操作的尝试都会引发进程异常：

![套接字关闭500](https://www.baeldung.com/wp-content/uploads/sites/4/2021/07/SocketClose500.png)

## 六，总结

在本文中，我们回顾了套接字的主要概念并回顾了它们的操作行为。接下来，我们研究了应用于套接字的关闭和关闭操作。

我们可以得出总结，尽管具有相似的特征，但关闭操作的执行不会破坏套接字；相反，它只是根据操作模式限制其通信能力。依次执行关闭操作，结束套接字(如果有)的连接，并关闭其文件描述符，最终销毁套接字。
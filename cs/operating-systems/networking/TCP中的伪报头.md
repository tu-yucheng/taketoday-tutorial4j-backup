## 1. 概述

网络和因特网的发展导致了对其所采用的通信协议的审查。这是一种自然现象，因为依赖网络通信的用户数量和不同技术每年都在增加。因此，网络会根据这些用户和技术要求而变化。

审查的协议示例包括 HTTP(1999 年 V1.1 和 2015 年 V2.0)、SMNP(1990 年 V1、1999 年 v2 和 2002 年 V3)和 IP(1981 年 V4 和 1995 年 V6)。此外，在这些示例之前，网络通信方式的相关变化发生在 70 年代：TCP 拆分为 TCP、IP 和其他协议。

但是，[当前的TCP](https://www.baeldung.com/cs/udp-vs-tcp#tcp)存在继承于遗留TCP 的特性。 因此，为了解决这些遗留特征，TCP 考虑了伪标头的存在。

在本文中，我们将探讨 TCP 上下文中的伪标头。 首先，我们将对 TCP 进行历史回顾。此时，我们将看到早期和现代 TCP 的相关特征。因此，我们将研究 TCP 中的伪标头。最后，我们将讨论当今伪标头的相关性。

## 2. 从早期的TCP到现代的TCP/IP

TCP 的第一个版本是由 Robert Elliot Kahn Vinton Gray Cerf 于 1973 年提出的。此时，TCP 是传输控制程序 ，而不是今天众所周知的传输控制协议。但是，这个早期 TCP 的目标与现代 TCP 目标完全兼容：

-   网络连接：网关授予网络之间的连接
-   分布式控制：没有网络控制和管理的中心点
-   Error Recover : 发送的包到达目的地(有丢包重传)
-   黑匣子：无需内部修改即可将网络连接到另一个网络

然而，此时，TCP 处理网络路由和网络流量的传输。总而言之，在此上下文中未使用 IP。因此，例如，有关数据包来源和目的地的信息由 TCP 负责。

[RFC 675](https://datatracker.ietf.org/doc/html/rfc675) 详细记录并介绍了这个早期版本的 TCP 。 显示早期和现代 TCP 之间差异的最有趣的点之一是它们的标头。下图总结了早期的 TCP 标头：

![早期TCP](https://www.baeldung.com/wp-content/uploads/sites/4/2021/12/EarlyTCP.png)

随着时间的流逝，网络变得越来越复杂，对网络路由和传输的异构层的需求也在增长。就这样，1976年开始了从早期TCP向现代TCP/IP转变的努力。最后，[RFC 791](https://datatracker.ietf.org/doc/html/rfc791)和[RFC 793](https://datatracker.ietf.org/doc/html/rfc793)在 1981 年正式提出了现代 TCP/IP。

随着网络路由现在由 IP 处理，TCP 在其所需信息方面得到了简化。下图描述了现代 TCP 基本标头：

![现代TCP](https://www.baeldung.com/wp-content/uploads/sites/4/2021/12/ModernTCP.png)

## 3. TCP/IP中的伪包头

从早期的 TCP 到现代的 TCP/IP 的过渡带来了一些挑战。 一个相关的例子是，根据定义，TCP(包括早期的和现代的)是一种端到端协议。这样，源地址和目标地址在通过 TCP 发送和接收消息中起着至关重要的作用。 

例如，TCP 校验和必须考虑端点地址(以及其他信息)，确保它们在传输过程中没有损坏。但是，在 TCP/IP 中，相关信息现在位于 IP 标头中，而不是 TCP 标头中。在这种情况下，IP 在网络层充当 TCP 的包装器。

因此，TCP 中出现了伪报头，以保持 TCP 的端到端特性，避免 IP 报头中可用的数据。 伪报头由 IP 报头的一部分组成。 它涵盖了 IP 标头的相关字段，这些字段是静态的(不改变数据包的路由)。

伪头一共包含 12 个字节，包含以下字段：

-   Src IP Address : 消息来源的地址(从 IP 头导入)
-   Dst IP Address：消息目的地的地址(从IP头导入)
-   保留：八位零
-   协议：IP 头的协议字段。对于 TCP，该值为 6。但是，其他传输层协议使用伪标头，例如[UDP](https://www.baeldung.com/cs/udp-vs-tcp#udp)，因此具有其他协议字段值
-   TCP 长度：TCP 段的计算长度。它包括TCP头和数据长度

下图显示了组成伪标头的字段：

![伪标头](https://www.baeldung.com/wp-content/uploads/sites/4/2021/12/Pseudo-Header.png)

### 3.1. TCP校验和

伪首部的一个具体应用是计算 TCP [校验和](https://www.baeldung.com/cs/crc-vs-checksum#what-is-a-checksum)。 除了伪头之外，TCP 校验和还使用协议头和主体。经过计算，TCP校验和值被分配到TCP头的校验和字段中。

需要强调的是，伪标头是按需定义的。这意味着它没有明确地在数据包中发送。在校验和的情况下，首先创建伪报头来计算校验和，然后丢弃。因此，接收方重新创建伪标头以在数据包到达目的地时评估校验和。

## 4. 现在的伪标头

使用伪标头的一个历史原因是安全性。这个想法是在 TCP 和伪报头数据中使用加密和身份验证。通过这种方式，设计人员旨在通过保护寻址信息来减轻中间人等攻击。

由于多种原因，这些安全协议没有得到推进。但是，正如我们在上一节中研究的那样，校验和仍然使用伪标头。因此，TCP 至今仍保留伪标头。

然而，由于伪报头的存在，IP 和 TCP 之间存在着一种紧张的关系。这意味着每次 IP 更改时我们都需要重新考虑 TCP。例如，从 IPv4 到 IPv6 的转换将需要修改伪标头。因此，TCP 的校验和计算也会发生变化。

考虑到所描述的场景，设计人员将需要评估在下一代网络中保留伪报头是否是一个好的选择。

## 5.总结

在本文中，我们了解了现代 TCP/IP 上下文中的伪标头。 首先，我们研究了从早期的TCP到TCP/IP的历史脉络。然后，我们深入探讨了伪标头的概念并看到了它的应用。最后，我们讨论了当今与伪标头相关的挑战。

鉴于有关 TCP 安全和身份验证的项目没有流行，我们可以得出总结，TCP/IP 的伪标头没有发挥其全部潜力。但是，其他应用程序(例如校验和)维护了如今有用的伪标头。因此，仍然需要知道在未来的网络中保留伪报头是否足够。
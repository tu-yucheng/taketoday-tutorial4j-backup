## 1. 概述

握手是一种典型的动作，例如，开始商务人士之间的对话。同样，我们的设备/进程执行握手协议以与其他设备或进程建立连接。以这种方式，连接的设备可以使用特定通信中涉及的所有各方商定的适当参数和规则交换消息。

在本文中， 我们将研究双向和三次握手的一般概念。因此，我们的最终目标是了解这些握手协议通常如何工作、它们的优点和缺点。

## 2. 握手基础

简而言之，使用握手协议连接各方意味着定义通信将如何发生。具体来说，握手可以在完全通信开始之前建立用于交换消息、数据编码和最大传输速率的协议。

一些应用程序需要握手。接下来，我们简要描述这个过程如何针对特定应用程序执行：

-   传输控制协议 (TCP)：打开常规 TCP 连接需要三次握手。因此，TCP旨在通过同步双方之间的消息交换来建立可靠的通信。
-   传输层安全性 (TLS)： TLS 连接需要客户端和服务器之间的一系列协议来保护通信。 通过这种方式，来自 TLS 的握手协议旨在为特定连接定义安全功能，例如加密算法和密钥。 
-   简单邮件传输协议 (SMTP)：建立 TCP 连接以交换消息后，SMTP 服务器和客户端必须通过特定的握手过程来标识自己。因此，除了验证服务器和用户之外，此握手过程还协商其他通信功能，例如采用的加密协议和最大消息大小。
-   拨号 Internet 访问：拨号调制解调器通过发出声音的非常有特色的握手连接自己。在这种情况下，通常，握手定义通信协议、禁用回声抑制、找到合适的调制并优化连接。

## 3. 双向握手

双向握手是一种简单的协议，用于在想要通信的两方之间创建连接。为此，该协议使用 [同步 (SYN) 和确认 (ACK) 消息](https://www.baeldung.com/cs/tcp-protocol-syn-ack)。

简而言之，SYN 消息需要连接并通知对方一个序列号以控制数据交换。实际上，TCP 序列号是在特定流上传递的字节数的计数器。反过来，ACK 消息用于确认接收到传入消息(使用序列号)。

[考虑到客户端/服务器模型](https://www.baeldung.com/cs/client-vs-server-terminology)，为了完成双向握手 ，客户端向服务器发送序列号 X 的 SYN 消息。然后，服务器应确认(ACK)SYN 消息，提供另一个序列号 Y 并建立联系。因此，序列号 X 将确认从客户端到服务器的消息，而序列号 Y 将确认从服务器到客户端的消息。

下图描述了前面描述的两次握手过程：

![台华](https://www.baeldung.com/wp-content/uploads/sites/4/2021/09/TWH.png)

特别是，当来自服务器的 ACK 消息延迟太多时，双向握手会带来潜在的问题。因此，如果发生连接超时，客户端会向服务器发送另一个带有新序列号(例如 Z)的 SYN 消息。但是，如果服务器之前发送了一个 ACK(延迟)，它将丢弃这个新的 SYN 消息。反过来，客户端接收延迟的 ACK 并假定它指的是最后发送的 SYN 消息。这就是错误发生的地方：客户端将发送序列号为 Z 的消息，而服务器需要序列号为 X 的消息。

下图显示了概述的问题：

![TWHE-1](https://www.baeldung.com/wp-content/uploads/sites/4/2021/09/TWHE-1.png)

三向握手过程解决了所描述的双向握手问题。

## 4.三次握手

与双向握手一样，三次握手也使用 SYN 和 ACK 消息在双方之间建立连接。但是，除了提供它们的序列号之外，服务器和客户端还相互确认序列号。此序列号确认避免了 SYN 重复错误的发生。

因此，让我们考虑一个客户端想要与使用三向握手协议的服务器进行通信。首先，客户端向服务器发送一条带有你的序列号 (X) 的 SYN 消息。服务器用包含其序列号 (Y) 的 SYN-ACK 进行回复，并确认客户端的序列号 (X)。之后，客户端发送ACK报文确认服务器的序号(Y)，最终建立连接。

下图演示了所呈现的三次握手过程：

![三WH](https://www.baeldung.com/wp-content/uploads/sites/4/2021/09/ThreeWH.png)

## 5.总结

在本文中，我们研究了三向和双向握手协议。首先，我们了解了握手的基本概念和示例。因此，我们回顾了与双向握手相关的流程和缺点。最后详细分析了三次握手协议的执行过程。

由于它们在两方之间建立了可靠的消息交换，我们可以得出总结，握手协议是当前网络通信的重要资源。
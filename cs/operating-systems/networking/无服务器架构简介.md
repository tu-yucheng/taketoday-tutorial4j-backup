## 1. 概述

在本教程中，我们将了解无服务器架构以及我们如何从中受益。我们还将探索一些我们可以使用的流行的无服务器平台。在此过程中，我们还将了解到这种架构风格的一些优点和局限性。

## 2. Serverless 背景

与行业中的许多其他流行语一样，很难可靠地追踪无服务器一词的来源。然而，重要的是欣赏它可以为我们的应用程序带来的好处。无服务器架构一开始听起来可能很奇特，但当我们更好地理解它时，它就有意义了。

### 2.1. 什么是无服务器？

通常，当我们开发应用程序时，我们需要服务器来托管和服务它们。例如，当我们开发一个捆绑为 WAR 文件的 Java 应用程序时，我们需要一个像 Tomcat 这样的应用程序容器来在可能具有虚拟化的 Linux 机器这样的主机上运行它。然后还有其他考虑因素，例如为基础设施提供高可用性和容错能力：

![应用基础设施](https://www.baeldung.com/wp-content/uploads/sites/4/2021/10/Application-Infrastructure.jpg)

当然，这意味着即使在我们能够满足第一个请求之前，我们也必须进行大量的准备工作。这并不止于此，因为我们必须从那里开始管理此基础设施以保持其可用。如果我们不必为所有这些与应用程序开发不严格相关的任务操心怎么办？

这是无服务器的基本前提。所以基本上，无服务器架构是一种软件设计模式，我们在第三方服务上托管我们的应用程序。它消除了管理必要的硬件和软件层的需要。此外，我们甚至不必担心扩展基础架构以匹配负载。

### 2.1. 是 Faas 还是 Paas？

在行业内，无服务器通常也被流行的术语功能即服务 (FaaS) 所笼统地广为人知。FaaS，顾名思义是一种云计算服务，它允许我们构建、运行和管理应用程序作为功能，而无需管理基础设施。但是，这不是与另一种称为平台即服务 (PaaS) 的结构非常相似吗？

嗯，基本上是的，但区别在于应用程序的部署单元。使用 PaaS，我们以传统方式开发应用程序并部署完整的应用程序，如 WAR 文件，并扩展整个应用程序：

![应用架构 PaaS](https://www.baeldung.com/wp-content/uploads/sites/4/2021/10/Application-Architecture-PaaS-1024x442.jpg)

但是，使用 FaaS，我们将应用程序分解为独立的和自治的功能。因此，我们可以将每个功能独立部署在 FaaS 服务上，并具有更精确的可扩展性：

![应用架构 FaaS](https://www.baeldung.com/wp-content/uploads/sites/4/2021/10/Application-Architecture-FaaS-1024x457.jpg)

此外，对于 PaaS，我们仍然必须管理可扩展性的某些部分，我们可以通过 FaaS 放弃这些部分。此外，我们希望 FaaS 在出现新请求时启动一个实例，并在不再需要时将其销毁。对于像整个应用程序这样的大型部署单元，这通常不是有效的方法。因此，FaaS 比 PaaS 的资源利用率更高。

由于缺乏对无服务器的准确定义，我们不应该太在意这个问题。基本思想是从基于云的服务可以提供的成本优化中获益。这可以通过只使用我们需要的计算资源来实现，而不必担心它来自哪里！这需要我们将应用程序重新设计为更小的临时部署单元。

## 3. 无服务器架构

虽然无服务器架构的基本前提非常吸引人，但理解如何处理它可能不是很直观。创建一个应用程序作为自主功能的组合说起来容易做起来难！让我们花些时间更好地了解无服务器架构，并探索应用程序究竟如何从中受益。

出于本教程的目的，我们将选择一个简单的应用程序来帮助我们管理任务。我们可以想象这个具有三层架构的简单应用程序：

![没有 FaaS 的应用架构](https://www.baeldung.com/wp-content/uploads/sites/4/2021/10/Application-Architecture-Without-FaaS.jpg)

我们可以使用流行的框架开发此应用程序，例如客户端的 ReactJS、服务器端的 SpringBoot 和数据库的 MongoDB。此外，我们可以将其部署在本地或云管理的基础设施上。但是，即使有多种自动缩放选项，我们也无法消除计算资源的浪费。

但是，我们可以用无服务器来降低它吗？让我们来看看。首先，我们必须将这个简单的应用程序重新架构为一组独立和自主的功能：

![FaaS 应用架构](https://www.baeldung.com/wp-content/uploads/sites/4/2021/10/Application-Architecture-With-FaaS.jpg)

在这里，我们将简单的应用程序分解为单独的函数来处理任务。虽然功能分解相当直观，但它的技术含义又如何呢？有几点值得讨论。

首先，我们必须依靠 FaaS 服务提供商提供的开发 SDK 和 API 进行开发。然后，我们还面临调试、监控和管理应用程序的传统工具的挑战。但是，从积极的方面来说，我们可以依靠 FaaS 服务提供商的原生能力来仅在需要时创建和管理功能实例。

## 4. 流行的无服务器平台

正如我们之前讨论的那样，无服务器架构的主要优势之一是我们可以将所有基础设施管理委托给第三方。当然，这意味着我们创建无服务器应用程序的能力在很大程度上取决于我们可用的服务。此外，无服务器不仅与单个服务有关，而且与使我们能够从无服务器架构中受益的一系列服务有关。

今天有相当多的云服务供应商可以吹嘘非常成熟的无服务器服务目录。由于我们可以非常灵活地定义Serverless，因此这些供应商提供的服务也非常不同。尽管它们有某些共同点。我们将探讨一些供应商提供的其中一些服务。

### 4.1. AWS 上的无服务器服务

AWS 上无服务器服务目录中最重要的服务是 FaaS 服务[Lambda](https://aws.amazon.com/lambda/)。AWS Lambda 是一种无服务器计算服务，让我们无需预置或管理服务器即可运行代码。它允许我们使用任何流行的语言(如 Node.js、Python、Go 和 Java)编写 Lambda 函数。我们可以简单地将我们的代码上传为 ZIP 文件或容器图像。

因此，我们可以对任何规模的流量使用精确的计算能力。此外，AWS 为我们的无服务器应用程序提供了许多其他服务。例如，用于构建事件驱动应用程序的[Amazon EventBridge 。](https://aws.amazon.com/eventbridge/)[Amazon API Gateway](https://aws.amazon.com/api-gateway/)用于创建、发布、维护、监控和保护我们的 API。[Amazon S3](https://aws.amazon.com/s3/)可存储任意数量的数据，具有可扩展性和可用性。

### 4.2. GCP 上的无服务器服务

同样，在 GCP 的产品中，[Cloud Functions](https://cloud.google.com/functions)是关键的无服务器产品。Cloud Functions 是一种可扩展的按需付费的 FaaS ，无需服务器管理即可运行我们的代码。它会根据负载自动扩展我们的应用程序。此外，它还提供集成的监控、日志记录和调试。此外，它还具有角色和功能级别的内置安全性。

GCP 的另一个重要产品是 PaaS 产品[App Engine](https://cloud.google.com/appengine)。Cloud Functions更适合更简单、独立和事件驱动的功能。但对于更复杂的应用程序，我们希望结合多种功能，App Engine 是更合适的无服务器平台。GCP 还提供 Cloud Run 以在 GKE 等 Kubernetes 集群上部署打包为容器的无服务器应用程序。

### 4.3. Azure 上的无服务器服务

类似地，Microsoft Azure 提供了一个 FaaS 服务[Azure Functions](https://azure.microsoft.com/en-in/services/functions/)，它提供了一个事件驱动的无服务器计算平台。我们还可以使用 Durable Functions 扩展解决复杂的编排问题，例如状态协调。我们可以连接到许多其他服务，而无需使用触发器和绑定进行任何硬编码。此外，我们也可以在 Kubernetes 上运行我们的函数。

和以前一样，对于更复杂的应用程序，Azure 也提供[App Service](https://azure.microsoft.com/en-in/services/app-service/)。它允许我们在完全托管的无服务器平台上构建、部署和扩展 Web 应用程序。我们可以使用 Node.js、Java 或 Python 等流行语言来创建我们的应用程序。此外，我们可以满足严格的企业级性能、安全性和合规性要求。

## 5. Kubernetes 上的无服务器

[Kubernetes](https://kubernetes.io/)是一个开源编排系统，用于自动部署、扩展和管理容器化工作负载。此外，像 Istio 这样的服务网格的专用基础设施层可以位于 Kubernetes 集群之上。这可以帮助我们解决许多常见问题，例如服务到服务的通信。

很自然地会考虑在 Kubernetes 之上利用 Istio 的组合来托管和管理无服务器环境。这种部署模型有很多好处。例如，它将我们与许多特定于供应商的服务分离。此外，它可以为无服务器应用程序提供标准的开发框架。

### 5.1. 原生的

[Knative](https://knative.dev/docs/)是一个基于 Kubernetes 的平台，用于部署和管理无服务器工作负载。它可以帮助我们很容易地建立可扩展、安全和无状态的服务。它附带 API，为常见的应用程序用例提供更高级别的抽象。此外，它允许我们插入自己的组件来进行日志记录、监控、网络和服务网格。

Knative 基本上由两个组件组成，Serving 和 Eventing。Serving 允许我们在 Kubernetes 上运行无服务器容器，同时它负责网络、自动缩放和版本跟踪。Eventing 为我们提供了一个用于订阅、交付和管理事件的基础设施。这使我们能够创建具有事件驱动架构的无服务器应用程序。

### 5.2. 凯玛

[Kyma](https://kyma-project.io/)为我们提供了一个平台，可以在 Kubernetes 上使用无服务器功能和微服务扩展我们的应用程序。基本上，它将精选的云原生项目汇集在一起，以简化扩展的创建和管理。Kyma 背后的基本思想是通过能够发送事件和接收回调来扩展现有应用程序。

Kyma 带有一个正确配置、监控和安全的 Kubernetes 集群。此外，它还提供用于身份验证、日志记录、事件记录、跟踪和其他此类需求的开源项目。它包含几个关键组件，涵盖无服务器计算、事件、可观察性、API 公开、应用程序连接、服务网格和用户界面。

## 6. Serverless 架构的局限性

到目前为止，应该清楚无服务器架构会导致最佳资源消耗。这本质上会导致较低的计算成本。更重要的是，由于无服务器平台的消费者不必担心基础设施，因此可以大大降低消费者的运营成本。

随时可用且高度可扩展的无服务器平台进一步缩短了上市时间并提供了更好的用户体验。但是，这种云计算架构风格可能并不适合所有用例，我们必须谨慎权衡成本和收益。除非我们也了解它的缺点，否则不可能完全重视无服务器。

### 6.1. 平台限制

无服务器架构的主要问题之一是供应商控制。当我们使用无服务器架构设计或重新设计我们的应用程序时，我们会自愿失去对系统许多方面的控制，比如我们可以使用哪些语言以及我们必须升级到哪些版本。当然，随着时间的推移，每个供应商的支持范围都在进一步扩大。

无服务器架构的另一个非常重要的问题是供应商锁定。正如我们之前所见，一个供应商的无服务器服务可能与其他供应商的服务大不相同。如果我们不得不更换无服务器平台的供应商，这可能会使我们变得困难而且代价高昂。这主要是因为我们依赖供应商提供的多项基础设施服务。

然后还有其他几个问题，例如我们必须注意的安全性。当以传统方式开发应用程序时，我们在安全方面有很多控制权。但是，很快我们开始采用无服务器服务，我们就会接触到特定于供应商的几种安全实现。这增加了应用程序的复杂性和攻击向量。

### 6.2. 应用限制

但是，有一些特定于我们如何开发应用程序本身的挑战。例如，由于无服务器工作负载在不使用时会缩减为零，因此可能会出现启动延迟。该问题通常被称为冷启动，可能由于多种原因而发生。对于偶尔触发并在 JVM 上运行的应用程序尤其如此。

另一个需要注意的非常重要的方面是测试。由于无服务器强调较小的自治应用程序，因此单元测试变得相当容易。但是集成测试呢？由于整个应用程序依赖于供应商提供的大量基础设施服务，因此实施集成测试变得具有挑战性。

那么，我们真正应该在哪里使用无服务器架构呢？对此没有一个好的答案。然而，应用程序中可能受益于无服务器架构的特征是异步的、并发的、不频繁的、零星的需求、具有不可预测的扩展需求、无状态的、短暂的和高度动态的。

## 七、总结

在本教程中，我们了解了无服务器架构的基础知识。我们了解如何采用常规应用程序并将其转换为从无服务器中受益。此外，我们探索了一些可供我们使用的流行的无服务器平台。最后，我们还讨论了无服务器架构的一些局限性。
## 1. 概述

在计算机科学中，混淆是一种隐藏实现细节的技术。它是事物的预期意义的模糊。因此，代码混淆是用来使代码或其编译对象更难阅读和理解的任何东西。

为什么会有人想要那个？

好吧，有些人通过默默无闻来提倡安全。他们的论点是：随着剥削成本越来越高，一些人会气馁。尽管这听起来很合理，但在实践中我们发现并非如此。也许技能较低的攻击者可能会面临更艰难的时期，但我们现在看到越来越熟练的犯罪分子。但重点是增加攻击的成本。

当然，为了更好的可维护性，代码越容易理解越好。更简单的编码可以简化向团队添加新编码员的过程。此外，它还可以更轻松地发现和修复错误或添加新功能。

因此，在使用这种技术的公司中，代码混淆通常在生产发布构建流中完成。自动化工具分析和混淆源代码或生成的字节码对象。

但是，有些人可能会直接在源代码中手动混淆关键函数。在这种情况下，逻辑是过度设计的，因此生成的对象会创建复杂的对象。

## 2. 代码混淆用例

混淆可以应用于源代码本身，或应用于编译后的对象。后者是最常见的。一般来说，人们一直在这些情况下使用代码混淆：

-   商业秘密预测：关键算法将更难找到、提取和逆向工程
-   防止规避：由于软件更难分析，滥用它需要更多的努力
-   减少加载时间：删除调试数据、注释、不需要的字符(空格、换行符等)，并减少对象名称。此外，许多可以删除未使用的库调用，从而大大减少构建包的占用空间。这是通过称为最小化器的特定混淆工具完成的。最著名的之一是[WebPack](https://webpack.js.org/)，用于许多 Javascript 框架，如[ReactJs](https://reactjs.net/bundling/webpack.html)和[VueJs](https://cli.vuejs.org/guide/webpack.html)。生成的应用程序应该具有更少和更小的资产，从而减少加载延迟

另一方面，作为一种安全措施，它不被认为是有效的保护。甚至还有自动化工具可以简化混淆代码的逆向工程。顺便说一句，事实上，我们绝不能仅仅依靠默默无闻的安全。

除了不像保护那样有效之外，还会出现其他问题：缺陷的堆栈跟踪更难分析。此外，它还增加了构建过程的复杂性。

## 3.逆向工程

在回顾混淆的工作原理之前，让我们先谈谈它试图避免的事情。逆向工程是分析产品的架构和功能的过程。在软件中，它甚至可以重新创建工作相似的源代码。这意味着，它可以修改和重建类似的系统。

这与用于分析恶意软件或寻找逆转勒索软件加密挑战的方法的过程相同。

逆向工程软件有多种方法。我们可以使用静态分析将二进制或字节码对象转换为可读形式。

结果可以是汇编语言(非常难读)，也可以是原始语言，这取决于所使用的框架。例如，Java JVM 或 .Net CLR 字节码对象可以很容易地转换回它们的原始语言 Java 和 C#。

动态逆向工程方法分析(或模拟)程序执行，观察其系统调用、输入和输出。它可以跟踪软件与其他系统和外部世界的交互。当前的[反编译器工具](https://www.baeldung.com/java-decompiling-classes)可以使用这两种方法来获得更好的结果。

## 4.混淆示例

让我们看一个使用这个非常简单的 java 类的小例子。此示例使用了以下工具：

-   [Proguard](https://www.guardsquare.com/proguard)，一种开源字节码 Java 混淆器和优化器。它通过分析应用程序的字节码对象来工作。它可以很容易地集成到建筑管道中。
-   [杰德](http://www.kpdus.com/jad.html)。这是一个开源的java反编译器。它将 JVM 字节代码反转回 Java 代码。尽管它很旧，但它仍然可用且可靠。

![混淆的](https://www.baeldung.com/wp-content/uploads/sites/4/2022/07/obfuscated.png)

正如我们所看到的，在逆向工程代码中，保留了类名，而丢失了变量名和注释。while循环被 java 编译器优化为更简单的for循环。我们还可以注意到一个空的实例化器方法，它是在编译期间添加的。

在混淆版本中，该类被确定为最终类，并且其名称丢失了。混淆器可以配置为生成长的、复杂的类名。此外，它可以在不同的范围和[签名(多态性)](https://www.baeldung.com/java-polymorphism)中重新利用名称。这会使它更难弄清楚。代码仍然是可读的，但是，在复杂的应用程序中，整理每个类、方法和变量代表什么可能会非常耗时。

## 5. 有任何实际的安全好处吗？

在基于字节码的框架中，例如 Java 或 .Net，大多数现代[反编译](https://www.baeldung.com/java-view-jar-contents)工具都可以帮助将类名和变量名映射为可读的内容。这意味着，一旦你命名了一个类或变量，它就会相应地重构代码。此外，它们可以映射，以便将来的反编译将利用它。

虽然混淆确实使逆向变得更加困难，但它无法阻止它。因此，我们可以说它的安全优势并不那么有效。

有些人尝试通过加密软件本身来超越混淆。但是，要运行，必须在运行时对其进行解密。因此，攻击者首先对解密例程进行逆向工程或拍摄内存中解密软件的快照。

## 六，总结

在本教程中，我们了解了混淆的工作原理以及该技术如何应用于 Java。我们还讨论了它如何影响逆向工程以及是否有任何切实的安全优势。

尽管有些人可能认为代码混淆会提高安全性，但事实并非如此。软件工程在任何情况下都是耗时的。而且，如果有足够的激励，它很可能不会阻止恶意方的企图。

当然，生成机器代码的编译语言更难进行逆向工程。以 C++ 为例。在这种情况下，我们应该使用反汇编程序，例如[IDA](https://hex-rays.com/ida-pro/ida-disassembler/)。因此，生成的代码应该更难分析并且非常长。小型 C++ 例程很容易导致长达一百页的汇编语言列表。
## 1. 概述

在本教程中，我们将简要探讨加密、数字签名和压缩内容对我们意味着什么。然后，我们将根据我们的具体需要，查看以不同顺序执行这些操作的效果。

## 2. 行动意味着什么

在我们能够探索以不同顺序执行这些操作的效果之前，我们需要了解这些操作是什么以及我们为什么要使用它们。

### 2.1. 数字签名内容

数字签名是密码学中的一种特殊结构，有两个用途。他们提供签名生成者的证明，这有助于消费者了解他们是否可以信任数据。他们还证明收到的内容与最初签名的内容完全匹配。

可以使用各种不同的方法对内容进行数字签名，但通常它们涉及公钥/私钥加密。这通过组合原始内容和签名者的私钥生成签名：

![img](https://www.baeldung.com/wp-content/uploads/sites/4/2023/01/Screenshot-2023-01-24-at-22.11.52.png)

然后可以通过将内容和签名与公钥结合起来，证明这是用于生成签名的密钥。成功验证签名的唯一方法是使用正确的公钥，以及正确的内容和正确的签名。如果这三个中的任何一个不正确，那么验证将失败：

![img](https://www.baeldung.com/wp-content/uploads/sites/4/2023/01/Screenshot-2023-01-24-at-22.13.07.png)

通过确保私钥确实保密，然后可以知道只有有权访问该密钥的人才能生成该签名，并且内容在生成签名时必须完全相同。如果不是，则签名不会生效。

请注意，还有加密哈希的概念，它证明内容没有改变，但不能证明任何关于来源的信息，因此也不能证明内容的可靠性。

### 2.2. 加密内容

加密是另一种加密结构，用于确保未经授权的人无法使用加密内容。如果恶意方拥有加密内容但无法对其进行解密，那么他们将无法对其进行任何操作。

加密的工作原理是获取原始内容并对其执行一些处理以生成加密内容。理想情况下，应该不可能从加密内容中分辨出任何关于原始内容的重要信息。例如，一些针对加密方案的攻击是通过从加密版本中存在的模式中检测有关原始内容的详细信息来进行的。

在某些情况下，加密通过发送者和接收者都知道的共享秘密来进行。在其他情况下，它使用公钥/私钥密码术，发送方将使用接收方的公钥加密内容，然后只有拥有适当私钥的人才能解密：

![img](https://www.baeldung.com/wp-content/uploads/sites/4/2023/01/Screenshot-2023-01-24-at-22.17.58.png)

理想情况下，不应该仅从加密内容中分辨出任何这些。

### 2.3. 压缩内容

压缩是一种技术，它允许我们将一定数量的内容编码到更小的空间中。例如，《[战争与和平](https://www.gutenberg.org/files/2600/2600-0.txt)》电子书的大小为 3.2MB，但我们可以使用 bzip2 将其压缩至 0.8MB——仅为原始大小的 26%。

通常，但并非总是如此，压缩是无损的。这意味着可以零缺陷地将压缩内容转换回完全未压缩的内容。然而，有时使用有损压缩可能是有益的，以数据丢失换取更高的压缩率。例如，JPEG 文件比许多其他图像格式的压缩效果要好得多，但这是通过图像中的数据丢失(希望是不易察觉的)来实现的。

压缩通常通过在原始内容中查找模式并用明显更短的字符串替换所有出现的这些模式来工作。当我们可以找到许多非常长的模式并将它们全部替换为可能的最短字符串时，这种方法效果最好。但是，如果输入数据是高度随机的，那么压缩可能无法达到很大效果(如果有的话)。

## 3.组合动作

既然我们知道可能的行动是什么，我们为什么要将它们组合起来呢？而且，如果我们确实想将它们结合起来，这样做有什么好处或坏处，或者我们这样做的顺序吗？

### 3.1. 结合加密和压缩

存在压缩以使有效载荷更小，从而使其更易于存储或传输。因此，将此与其他行动结合起来以维持该收益似乎是合理的。但是，压缩通过识别模式并用其他模式替换它们来工作。这实际上意味着将其与加密相结合可能不会带来好处。

如果我们决定首先加密我们的数据，那么最终结果应该看起来尽可能随机——也就是说，它的模式尽可能少。这意味着加密内容将特别难以压缩。例如，我们使用 AES-256-CBC 加密的《战争与和平》文件仍然约为 3.2MB，但压缩后的文件实际上要大一些！

相反，我们可以先压缩数据。这将起作用，并且我们将在仍然被加密的同时得到更小的结果。然而，这可能会让我们面临更多加密风险，因为压缩实际上可能会强调内容中最初存在的任何模式，从而使它们更难隐藏在加密输出中。例如，[CRIME](https://en.wikipedia.org/wiki/CRIME)和[BREACH](https://en.wikipedia.org/wiki/BREACH)攻击是现实世界的例子，其中加密内部压缩使攻击成为可能。

### 3.2. 结合加密和签名

我们内容的加密和签名一起进行得很好。它们以互补但不完全相同的方式工作。签名证明收到的内容正是发送的内容，并且是由我们预期的人签名的，并且加密通过确保没有未经授权的方可以使用内容来起作用。

但是我们应该以什么顺序执行这些操作呢？

如果我们在签名之前加密内容，那么接收方将知道接收到的有效负载是预期的，而无需对其进行解密。这在负载从一个系统转发到另一个系统的某些情况下可能很重要——中间系统无法解密内容，但仍然可以确保它是正确的。

然而，这确实带来了签署方自己不知道原始内容是什么的风险。它真正保证的是加密的有效负载没有被篡改，并且它对原始数据只字不提。反过来，这可能会导致接收者在不应该信任内容的情况下信任内容。

例如，恶意负载可以在被签名之前被加密并替换原始负载。收件人无法知道发生了什么，并且签名将暗示有效负载与签名时的内容完全匹配。更糟糕的是，签署内容的系统可能无法知道这已经发生，如果他们不是首先负责加密的人的话。

相反，如果我们在加密内容之前对其进行签名，则表明签名者知道原始内容是什么，但只有能够解密内容的人才能访问签名。这给了我们更强的保证，但只对那些可以解密数据的人。中间系统将无法依赖该系统作为内容正确的证据，因此必须采用其他方式。

### 3.3. 结合压缩和签名

我们可以结合压缩和签名的第三对操作。由于无论是签名还是压缩我们的内容都不会从恶意的眼光中掩盖内容，因此从这个角度来看，将这些内容结合起来是没有风险的。但是，根据我们的压缩算法的具体工作方式，这可能并不总是有益的。

与加密一样，如果你在压缩内容之前签名，那么只有能够或愿意解压缩内容的系统才能验证签名。由于解压缩内容需要时间和资源，中间系统很可能不会执行此操作，因此无法验证签名。然而，最终的接收者仍然能够做到这一点，并且仍然能够像往常一样从签名中受益。

还有一个额外的风险，如果压缩是有损的，压缩的结果将破坏内容和/或签名，从而使它们无用。 有损压缩算法在这种情况下并不常见，因此这种风险不大，但我们仍然需要考虑。

如果我们改为对压缩内容进行签名，那么我们就没有这种风险。但是，我们再次遇到签名用于压缩有效负载的情况，并且不能保证签名者知道原始有效负载是什么。和以前一样，恶意方可以在签名之前替换有效载荷，而接收者将无从知晓。在这种情况下，签名者至少可以先解压缩有效负载并对其进行验证，因为这样做没有任何限制。

## 4.总结

在这里，我们了解了数字签名、加密和压缩我们的内容可以做什么，以及将这些结合使用的一些潜在好处和缺点。特别是，我们已经看到将压缩和加密结合起来可能没有什么好处，但是如果处理得当，将其中任何一个与数字签名结合起来确实有好处。
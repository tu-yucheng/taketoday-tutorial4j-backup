## 1. 概述

单点登录机制 ( [SSO](https://www.baeldung.com/sso-spring-security-oauth2) ) 允许用户登录一次应用程序并访问所有相关系统，而无需单独登录。在本文中，我们将详细定义 SSO 的工作原理以及该技术的优缺点。

## 2. 基础

正如我们所提到的，多亏了 SSO，用户可以登录一次服务并自动登录到所有相关的应用程序。例如，让我们考虑一个 Google 帐户。在登录到 Google 的一项服务(例如 Gmail)后，用户被授予访问所有其他独立应用程序(如 Youtube、Google Play 或 Google Drive)的权限。此外，在所有这些相关系统中都使用相同的凭据。

在组织中，员工每天使用多个应用程序。SSO 摆脱了单独登录它们的需要。此外，用户不需要存储或记住多个凭据。因此，系统管理员在配置对系统的访问方面的工作较少。随后，忘记或无法使用凭据的情况就不太可能发生并且更容易处理。正如我们所见，SSO 可以改进组织中的多个流程。

### 2.1. 联合身份

首先，让我们定义[联合身份](https://en.wikipedia.org/wiki/Federated_identity)必须处理的问题：

-   [验证](https://www.baeldung.com/spring-security-authentication-and-registration)
-   [授权](https://www.baeldung.com/spring-security-custom-oauth-requests)
-   用户管理

身份验证是验证用户身份的过程。简单来说。它确保用户确实是他或她声称的那个人。有很多流行的身份验证方法，如密码、软件或硬件令牌、个人身份证号码、指纹等。

授权过程验证用户是否有权访问特定资源。例如，在线商店管理员将能够访问买家不应该访问的资源，例如，更新产品的价格。授权应该总是在身份验证之后发生。

用户管理是对用户账号的监管。所以，一般来说，创建、存储和修改它们。

单点登录仅与身份验证过程相关。因此，它本身并不是一个联合身份，而只是它的一部分。它的任务是验证用户的身份并在相关应用程序之间共享该信息。

让我们看看 SSO 在实践中是如何工作的。

### 2.2. 工作流程

下面简单介绍一下SSO解决的问题。我们希望用户能够在域 1 和域 2 中使用相同的登录名和密码登录。此外，如果用户已经在 domain1 登录，他应该自动在 domain2 登录，反之亦然。解决方案是在域之间共享会话数据。但是，由于[同源策略， ](https://en.wikipedia.org/wiki/Same-origin_policy)[cookie](https://www.baeldung.com/cookies-java)不能在域之间共享。因此，SSO 通过对用户进行身份验证并以各种方式共享他们的会话数据来解决问题。

我们将在下一节介绍不同的 SSO 配置。通常，有一个中心域可以识别用户并共享他们的会话数据，例如以[JWT](https://www.baeldung.com/spring-security-oauth-jwt)的形式。让我们大致描述一下 SSO 过程。

1.  用户进入domain1
2.  domain1 检查没有会话 cookie，因此将用户重定向到 SSO 系统
3.  SSO系统检查没有会话cookie所以提示登录页面
4.  SSO系统对用户进行认证
5.  SSO 系统设置会话 cookie(如果身份验证成功)
6.  SSO 系统使用包含会话数据(例如 JWT)的参数重定向回 domain1
7.  domain1 使用传递的数据设置会话 cookie
8.  用户进入domain2
9.  domain2 检查没有会话 cookie，因此将用户重定向到 SSO 系统
10.  SSO 系统检查会话 cookie 是否存在
11.  SSO 系统使用包含会话数据(例如 JWT)的参数重定向回 domain2
12.  domain2 使用传递的数据设置会话 cookie

上面的方法是最通用的一种。它可能因实施的 SSO 配置和体系结构而异。下面我们可以在图上看到前面描述的过程：

[![sso](https://www.baeldung.com/wp-content/uploads/sites/4/2021/01/sso.svg)](https://www.baeldung.com/wp-content/uploads/sites/4/2021/01/sso.svg)

## 3.架构

有多种体系结构可用于实现 SSO。

常见用例由 WEB SSO 处理。WEB SSO 仅适用于可使用网络浏览器访问的服务。它允许用户通过一次登录访问一组 Web 服务器。实现 WEB SSO 主要有两种方法：

-   使用基于网络的反向代理控制身份验证过程
-   使用安装在每个特定服务器上的代理

这种架构通常使用 cookie 来跟踪用户的身份验证状态。上一节介绍的单点登录流程适用于WEB单点登录架构。

下一个架构称为企业单点登录 (E-SSO)。它与 WEB SSO 略有不同，更改对最终用户是透明的。用户拥有 E-SSO 客户端的单一凭据并且仅登录一次。E-SSO 处理相关应用程序的登录。不同之处在于服务可以具有单独的身份验证凭据。由 E-SSO 客户端维护。此外，应用程序不需要了解 E-SSO 客户端。当组织希望为现有和配置的系统提供 SSO 时，这种架构尤其常见。

SSO 旨在用于单个组织内。联合 SSO 体系结构提供跨不同组织信任的身份验证数据(通常是令牌)。该架构使用 WS-Federation、[OAuth](https://www.baeldung.com/spring-security-oauth)或 SAML 等流行协议来传递令牌。SSO 体系结构在多个组织合作的情况下特别有用。

## 4. 优点和缺点

下面我们来分析一下SSO方案的优缺点。

优点：

-   简化使用多种服务的最终用户的登录过程
-   减少忘记或不工作凭据的情况。因此，它减少了服务台的成本和工作量
-   简化凭证管理
-   通过减少凭证暴露来提高安全性
-   可以改善组织之间的整合与合作

缺点：

-   当 SSO 提供商关闭时，所有应用程序都无法访问
-   实施 SSO 可能既费时又费钱
-   窃取 SSO 凭据可让黑客访问所有相关系统
-   必须强制使用强而复杂的密码
-   一些 SSO 提供商与第三方共享数据。需要对提供商的条款和政策进行深入研究

## 5.总结

在本文中，我们详细讨论了单点登录。首先，我们介绍了 SSO 的基础知识和联合身份的主要关注点。其次，我们介绍了一般的 SSO 工作流程。然后，我们简要描述了不同的 SSO 架构。最后，我们概述了 SSO 解决方案的优缺点。
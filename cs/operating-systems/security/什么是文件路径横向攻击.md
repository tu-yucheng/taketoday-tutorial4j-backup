## 1. 概述

在本教程中，我们将讨论什么是文件路径横向攻击，这是一种常见且非常危险的漏洞。文件路径或目录横向攻击是旨在获得对不应公开访问的文件夹和文件的访问权限的威胁。通常的目标是应用程序源代码和数据，甚至是操作系统关键文件。

## 2.路径横向漏洞

简而言之，攻击者的目标是探索目标的文件系统。这可以从读取文件、检索源代码和数据文件，甚至操作系统关键文件(如密码哈希)开始。如果攻击者可以写入文件，如上传，则可能更加危险。他可以修改应用程序、破坏应用程序、上传后门程序和虚假代码，甚至可以通过修改密码文件在主机上创建新的用户凭据。因此，容易受到这种攻击的应用程序是那些允许用户为某些操作指定文件名(无论它是否在 URI 或 POST 后查询参数中)的应用程序。如果他们不检查字符串上是否有任何绝对或相对路径分配，就会出现问题。例如：

```http
http://www.somecompany.com/someapp/download?file= ../../../../../../../../../etc/passwd
```

在这种情况下，攻击者使用“../”序列来利用下载功能。Linux 中的“../”(Windows 中的“..”)表示“从当前路径转到目录”。这是此类攻击最常见的模式，也称为“点-点-划”攻击。此外，恶意参数可能会尝试在目标文件系统上查找相对或绝对路径。而且，更糟糕的是，可以通过多种方式混淆“../”，从而更难识别攻击企图。使用编码变体，例如：

-   “%2e”、“%252e”(双重编码)或“%c0%ae”(UTF8 编码)放置一个 . (点)
-   “%2f”、“%252f”(双重编码)或“%c0%af”(UTF8 编码)放置斜杠 (/)
-   “%5c”、“%255c”(双重编码)或“%c1%9c”(UTF8 编码)放置反斜杠 ()
-   “%3a”、“%253a”(双重编码)或“%c0%3a”(UTF8 编码)放置冒号 (:)

最后但并非最不重要的一点是，一些存档格式(例如 .zip)也允许路径横向。因此，如果需要将存档提取到文件系统，则必须特别小心。

## 3. 缓解路径横向攻击

请注意，例如，路径横向漏洞是勒索软件攻击的常用载体之一。它可能允许将勒索软件代码上传到我们的应用程序服务器。通过替换部分应用程序代码，下一步就是欺骗服务器执行它。因此，我们可以做一些事情来适当地减轻路径横向攻击，我们可以使用一些修改：

-   避免使用带有用户提供的参数的文件系统访问 API
-   确保应用程序服务器以受限权限运行，即只能读取和写入所需路径并使用[访问受限凭证](https://www.baeldung.com/linux/setuid-and-user-ids)
-   [Chroot](https://man7.org/linux/man-pages/man2/chroot.2.html)你的应用程序。chroot系统调用将 应用程序执行上下文捕获到特定文件夹路径。这确保了应用程序将无法读取或写入它不应该读取的文件
-   根据有效模式验证任何用户输入。这是一个[永远不会过时的建议](https://www.baeldung.com/cs/sql-injection)。关于文件名，我们必须评估文件名用户参数以检查它们在预期范围内是否有效

## 4。总结

正如我们在本教程中看到的，即使是一个简单的漏洞也可能具有很大的破坏性。在路径横向的情况下，让用户提供的文件名未经适当验证就足以产生很多问题。因此，请记住，在验证用户输入时，我们永远都不够小心。通过适当的验证，我们可以避免困扰全球 Web 应用程序的许多常见缺陷。
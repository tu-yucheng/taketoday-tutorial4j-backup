## 1. 概述

内存管理涉及计算机系统如何处理主内存。 总之，主存储器维护计算机处理单元可直接访问的资源(指令和数据)。因此，处理单元可以使用这些资源来执行不同的进程。然而，多年来，管理主内存是一项复杂的任务，采用不同的策略。

在本教程中，我们将特别探讨 [随机存取存储器](https://www.baeldung.com/cs/registers-and-ram#ram)(RAM) 的管理。首先，我们将检查操作系统的内存管理器及其特定活动。接下来，我们将简要回顾一些程序在计算机系统主存中的映射策略。最后，我们将研究内存管理方案，考虑早期系统采用的方案和大多数现代计算机系统中使用的基于[虚拟内存的方案。](https://www.baeldung.com/cs/virtual-memory)

## 2.内存管理器

操作系统的内存管理器处理计算机的主内存，尤其是 RAM。以这种方式，内存管理器必须执行无数活动以使处理单元能够访问代码和数据，然后执行进程。接下来，我们简单描述一下内存管理器的一些相关活动：

-   请求验证：内存管理器检查内存请求的有效性以及申请者是否具有请求内存分配的适当权限
-   分配：搜索满足特定内存请求的空闲内存部分，为它们分配所需的资源
-   释放：终止或空闲进程或进程作业的内存释放
-   碎片整理：重新排列内存以建立更多可用的空闲内存部分

内存管理器执行这些活动所采用的策略和策略可能会根据采用的内存管理方案而改变。 有多种内存管理方案。其中一些方案具有更高的性能(就内存管理器活动的执行时间而言)但效率较低(就利用所有可用内存而言)。另一方面，现代方案通常更复杂，通常表现出较低的性能但较高的效率。

## 3.内存映射

内存映射是指将程序分配到主存的分配策略。在早期系统中，一般策略是将请求的程序直接映射到主存储器连续空间中的物理位置。 因此，即使是程序访问的内存地址也对应于物理内存地址。

随着编程可能性的增加，程序占用的内存也越来越大。许多程序最终变得比计算机系统中的可用内存还大。因此，在内存中分配整个程序并将程序直接映射到物理内存位置变得不可行。

这个上下文促进了虚拟内存的创建。有了虚拟内存，一个程序可以被分成多个映射到虚拟地址的片段。 这些程序片段又在物理内存中按需分配和释放，仅将必要的虚拟地址链接到物理地址。

下图举例说明了早期系统和启用虚拟内存的系统中的内存分配：

![内存分配3](https://www.baeldung.com/wp-content/uploads/sites/4/2021/10/MemoryAllocation3-1536x653-1-1024x435.png)

## 4.内存管理方案

内存是计算的重要资源。值得注意的是，可用内存总量及其处理数据的速度会影响计算机的性能。然而，除了硬件特性之外，逻辑决策会影响内存用于允许进程执行的方式，通常还会影响计算机系统的性能。

在我们的上下文中，一个突出的逻辑决定是内存管理器采用的管理方案。因此，在接下来的小节中，我们将探讨不同的内存管理方案以及内存管理器如何与它们中的每一个一起工作。

### 4.1. 早期系统的内存管理方案

一般来说，早期计算机系统的内存管理非常简单。接下来让我们看一些关于这些系统最常见的内存管理方案的信息。

Single User Contiguous 是第一个也是最简单的内存管理方案。在这种情况下，内存管理器将所有可用内存分配给一个唯一的程序。所以，如果内存管理器已经释放了前一个程序，它只能分配一个新程序。

固定分区方案将可用内存划分为固定大小的分区，从而允许同时分配多个程序。这些内存分区是在计算机系统启动时定义的，除非重新启动，否则不会被修改。在这种情况下，内存管理器采用分区内存表来跟踪内存并确定特定程序应该分配在哪个分区上。

动态分区方案将计算机内存划分为动态指定的分区，避免内存浪费情况。这里还需要分区内存表。然而，这种方案使内存管理器能够在计算机系统执行期间修改内存表行(分区)。

具有分区的内存管理方案需要一种分配程序的策略。让我们看看其中的两个：

-   First Fit Allocation：内存管理器在第一个找到的具有足够内存的分区上分配一个程序
-   Best Fit Allocation：内存管理器找到分配程序的最佳分区。最佳匹配是指在尽可能小的可用分区(固定分区)中分配程序或在连续分区(动态分区)中保持最大可用内存

然而，早期系统中使用的所有方案都有一个共同的问题： 它们将整个程序存储在主内存中，无法执行大于可用物理内存的程序。这个问题促进了基于虚拟内存的新内存管理方案的开发。

### 4.2. 基于虚拟内存的内存管理方案

虚拟内存允许按需将程序片段分配到内存的非连续部分。因此，出现了新的管理方案，如下所示。

分页内存方案允许将程序分成大小相等的块，称为程序页。同样，该方案将主存分成多个页框来分配程序页。因此，在分配一个程序之前，内存管理器定义了一个程序由多少页组成，以及在分配时使用哪些页框。分页内存一次分配整个程序，但现在不需要使用连续的内存空间来完成它。此外，内存管理器使用程序页面、页面映射和内存映射表来跟踪占用的页面帧。

Demand Paging 方案通常作为分页内存运行。但是，内存管理器现在可以按需分配程序页面。 这意味着请求分页消除了将整个程序同时保存在内存中的要求。这种按需分配扩展了页面映射表，该表现在包含页面分配、修改和最近使用的状态标志。

Segmented Memory 方案继承了请求分页的大部分操作特性。然而，在这种情况下，程序被分成多个段，这些段具有表示程序逻辑结构的不同大小。因此，内存管理器不使用页映射表，而是使用段映射表来控制程序段的分配和释放。

段请求分页内存方案将请求分页与分段内存合并。实际上，它表示内存管理器将段划分为大小相等的页面。 因此，内存管理器受益于程序的逻辑分段和相等大小页面的简化管理。

最后，按需分配程序的方案会频繁更换内存中的页/段，需要采用[更换策略](https://www.baeldung.com/cs/virtual-memory#4-page-replacement)。

## 5.总结

在本文中，我们研究了计算机系统中的内存管理。首先，我们研究了有关内存管理器的概念。然后，我们分析了内存是如何映射到早期和现代系统中的物理内存的。最后，我们概述了几种内存管理方案，从最简单的到最复杂的。

特定内存映射策略或内存管理方案的选择会直接影响，例如，处理单元的性能(可能会花费更多时间等待内存操作)和内存本身的使用效率(增加或减少内存浪费). 因此，我们可以得出总结，设计良好的内存管理是现代计算机的关键要求。
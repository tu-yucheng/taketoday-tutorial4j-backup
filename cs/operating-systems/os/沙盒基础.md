## 1. 概述

在计算机安全和软件开发中，沙箱指的是一种环境，在该环境中，程序可以与系统的其余部分隔离运行，但对资源的访问权限有限。这对于测试可能容易触发系统故障或行为不当的流程部分很有用。

当沙箱中发生任何事情时，它不应该泄漏到机器的其余部分。通常，我们可以限制进程分配的内存空间、它拥有的网络访问权限(如果有的话)以及它可以访问的目录。

在本文中，我们探讨了用于沙盒应用程序的不同概念和架构。

## 2.概念

以下每一种架构都有优点和缺点。这些根据它们的部署速度、它们对硬件组件的抽象级别以及应用程序需要运行的系统的复杂性而有所不同。通常，在低级别对硬件组件进行分段的方法将具有更好的隔离性。

相比之下，通过多个软件级别抽象架构的方法更加灵活和可扩展：

![虚拟机容器图](https://www.baeldung.com/wp-content/uploads/sites/4/2022/01/VM-container-diagram-1-1.png)

### 2.1. 虚拟机和管理程序

首先，虚拟机 (VM) 可以看作是同一机器硬件内部的“微型计算机”。多亏了管理程序，独立操作系统与独立文件、库和应用程序的这些不同组合都可以在同一台计算机内运行。管理程序是一些软件或固件，可以将现有的硬件资源分配给我们每个不同的虚拟机。

这个过程称为“虚拟化”，类似于在同一台计算机上的不同环境之间设置虚拟屏障。虚拟机需要几分钟才能启动，而且通常比容器慢。但是，它们在应用程序之间提供了更好的隔离。

### 2.2. 容器和容器引擎

从 VM 开始，容器是分离应用程序的另一种方式。在同一操作系统上运行的应用程序可以自动容器化、部署和扩展。随着 Docker 等工具和 Kubernetes 等计算机集群工具的进步，容器最近越来越受欢迎。

这些不同的应用程序都在相同的硬件上运行，但有不同的限制。容器引擎用于管理网络连接、内存和容器可用的其他资源。这些资源甚至可以根据每个容器的需要进行扩展。

因为部署这种方法比使用虚拟机更快，所以容器提供了一种快速组装和拆分相互通信的应用程序网络的方法，因为每个应用程序都将在自己的小型预制环境中运行。部署容器只需几秒钟，而虚拟机只需几分钟。

### 2.3. 操作系统模拟

对于这种方法，沙箱将一个操作系统，但不会模拟任何物理硬件。一个操作系统的完整模拟对于计算机来说可能是一项繁重的任务。

因此，很多操作系统模拟软件只会模拟一些最常见的系统调用。

高级类型的恶意软件可以使用不频繁的系统调用，通过在沙箱内显示为非活动状态来规避此类沙箱。

### 2.4. 全系统仿真

在完整的系统模拟中，你机器上的所有资源都将被模拟，以便深入了解沙盒进程正在做什么。

从 CPU 到屏幕上的显示，一切都由软件模拟，然后交给沙盒程序。这类似于容器，只是仿真不受底层机器操作系统架构的限制。

仿真引擎可以模拟各种各样的系统架构，并不局限于个人计算机或服务器。例如，他们可以手机和视频游戏机操作系统。因为整个系统是仿真的，所以可以分析发送到计算机不同部分的信息。

这用于深入了解在其中运行的应用程序的行为。

## 3.规避技术

聪明的恶意软件将能够检测到它们运行的环境。通过使用此技能，不同的恶意软件在模拟环境中运行时可以看起来很安全，并在检测到实际主机时突然变得活跃。

然后，恶意软件可以采用不同的技术来掩盖自己的踪迹。执行此操作的最流行技术之一称为进程注入。该技术将在与正在运行的进程相同的地址空间中运行有效负载代码。这通常会使检测与恶意软件相关的特定进程变得更加困难。

虽然完整的系统模拟可以解决这个问题，但模拟的质量需要足以让恶意软件看起来像一个真实的系统。

## 4。总结

在本文中，我们讨论了沙盒中的不同基本概念。
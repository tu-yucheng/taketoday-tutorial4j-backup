## 1. 概述

内存是计算机系统最重要的组件之一。了解操作系统如何管理内存总是有益的。它对于开发软件组件非常有用。在本教程中，我们将使用 C 编程语言讨论动态内存的概念，并提供一些有关常见错误的信息。

## 2.什么是动态内存？

当应用程序加载到系统内存中时，通常分为三个主要区域：堆栈、堆和代码。下图显示了应用程序内存分配的一般视图：

![memalloc 小时](https://www.baeldung.com/wp-content/uploads/sites/4/2022/03/memalloc_hr-738x1024.png)

栈区负责存放程序的局部变量。函数开头的变量和数组，包括 main，位于堆栈空间中。堆栈从高地址向低地址增长。

另一方面，堆区域负责动态内存分配。与栈不同，堆是从低地址向高地址增长的。顺便说一句，请务必记住，堆区域与堆数据结构没有任何关系。当[指令](https://www.baeldung.com/cs/instructions-programs)位于代码空间时，全局和静态变量进入静态/全局部分。

## 3.动态内存分配

术语动态内存分配是指在系统运行时管理系统内存的过程。malloc() 、calloc()、realloc()和free()是 C 编程语言中执行动态内存管理的四个函数。C标准库头文件stdlib定义了C编程语言的这四个动态内存分配函数。

动态内存分配利用系统内存的堆空间。让我们仔细看看四个动态内存管理函数。

### 3.1. 分配()

malloc()是一个分配内存堆块的函数。特别是，它为用户分配指定数量的字节但不初始化它们。应用程序使用malloc()返回的指针来访问已分配的内存块。它默认返回一个 void 类型的指针，但是，我们可以将它转换为任何数据类型的指针。如果没有足够的空间容纳malloc()请求的内存量，分配将失败并返回[NULL](https://en.wikipedia.org/wiki/Null_pointer)指针。它唯一的参数是要分配的内存块的大小。

### 3.2. calloc()和realloc()

calloc()或连续分配与 malloc 类似，但在此函数中，我们还可以指定要分配的内存块数。与 malloc 不同，它有两个参数：要分配的内存块数和每个内存块的大小。它用值 0 初始化每个块。当我们希望结构的所有成员都初始化为零时，我们通常更喜欢使用calloc() 。

另一方面，realloc()代表重新分配。当之前分配的内存可能不够时，我们可能需要更多的内存。在这种情况下，我们可以使用realloc()动态重新分配内存。

### 3.3. 自由()

我们使用 C 中的free()函数来动态释放内存。当我们使用malloc()或calloc()分配内存时，内存不会自行释放。这就是为什么我们需要使用free()方法来释放内存。

## 4. 常见错误

动态内存分配的不正确使用是问题的常见来源。安全缺陷或程序崩溃，最常见的原因是分段错误，是常见错误的示例。

最常见的错误可归纳如下：

-   不检查分配失败
-   内存泄漏
-   逻辑错误

### 4.1. 不检查分配失败

正如我们所提到的，分配内存操作可能不会总是成功，它可能会返回一个空指针。如果我们在不检查分配是否成功的情况下使用返回值，我们将得到意想不到的结果。这通常会导致崩溃。由于空指针，我们将遇到分段错误。但是，不能保证这会发生，因此依赖它可能会造成困难。

### 4.2. 内存泄漏

不可重用内存是使用 free 函数无法释放内存所带来的问题之一。程序可能不再使用它，这会浪费内存资源。当资源耗尽时，这种情况可能会导致分配问题。

虽然在 C 中没有缓解内存泄漏的高级概念，但在 C++ 中，[资源获取即初始化](https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization)(RAII) 概念提供异常安全、[封装](https://www.baeldung.com/java-oop#encapsulation)和局部性。因此，它允许开发人员处理内存泄漏。

### 4.3. 逻辑错误

逻辑错误是处理动态内存分配时的另一种常见错误。正如我们所讨论的，每个分配都有相似的模式。它们从使用 malloc 进行分配开始，使用数据存储开始，使用 free 函数进行释放。在调用 free(悬空指针)之后或调用 malloc(野指针)之前尝试使用内存，两次调用 free 和类似的逻辑错误可能会导致分段错误，这可能会导致应用程序崩溃。这些问题可能难以诊断。

## 5.总结

在本教程中，我们解释了什么是动态内存，并提供了一些有关 C 编程语言中动态内存分配的信息。我们还提到了动态内存分配的功能和常见错误。
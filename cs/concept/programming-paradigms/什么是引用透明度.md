## 一、简介

在本教程中，我们将研究函数的一个特殊属性，称为引用透明性。首先，我们将讨论它如何应用于多种编程语言和范例。因此，我们还将看到它对代码可以自动优化的程度有相关影响。

## 2.参照透明

引用透明性是函数的一个属性，允许它被等效的输出替换。简单来说，如果你使用相同的参数第二次调用该函数，你一定会得到相同的返回值。

### 2.1. 例子

让我们考虑以下函数，它计算 2 个数字的总和：



![由 QuickLaTeX.com 呈现](https://www.baeldung.com/wp-content/ql-cache/quicklatex.com-575642da03dc60c8d2c522ce5aaf7363_l3.svg)



该函数在引用上是不透明的，因为其签名中定义的参数并不是该函数使用的所有资源。

a和 b 变量是从函数体内的标准输入中读取的，因此具有相同参数的两个函数调用可能会产生不同的结果。

为了使函数引用透明，我们需要从函数中提取输入部分：



![由 QuickLaTeX.com 呈现](https://www.baeldung.com/wp-content/ql-cache/quicklatex.com-f0b563189edcb5f6595ff2fbb8a52a55_l3.svg)



请注意，这不会阻止我们与用户输入进行交互，我们仍然能够读取 a 和 b 的值。因此，在代码片段中，add 函数是透明的，而 main 函数则不是。



## 3. 与编程范式的关系

正如我们所见，如果一个函数与外部信息源(标准输入、套接字、文件)交互，它就会变得引用不透明。

根据我们使用的编程语言，函数可以通过不同的机制与其声明的参数以外的数据进行交互。

在本节中，我们将举例说明引用透明性如何受到不同编程范式的影响，例如命令式编程、面向对象编程和函数式编程。

### 3.1. 命令式编程

命令式编程是一种将程序理解为指令序列的编程范式。这是大多数人最初想到编码的方式：我们定义计算机为获得所需结果而必须经历的所有步骤。

示例：C、C++

在命令式编程中，全局变量和静态变量可用于跨不同函数存储和访问数据。由于可以随时修改这些变量，因此它们破坏了使用它们的任何函数的引用透明性。

这是第一个例子：



![由 QuickLaTeX.com 呈现](https://www.baeldung.com/wp-content/ql-cache/quicklatex.com-9f7c1275e87521287d0ecb75d1d1b041_l3.svg)



add 函数没有任何参数。但是，它使用全局变量a 和 b 。由于这些变量可以被任何函数更改，因此 add 是引用不透明的。



这是 C++ 语言中的第二个示例：



![由 QuickLaTeX.com 呈现](https://www.baeldung.com/wp-content/ql-cache/quicklatex.com-f2997e57779378147a52f5f8ff9edf51_l3.svg)



在 C++ 中，静态变量在函数调用之间记住它的值。

在代码片段中，我们通过连续调用 add 函数将 a、b 和 c 的总和累加到 s 变量中。因为 s 在函数调用中保持其值，所以 add 变得引用不透明。

### 3.2. 面向对象编程

面向对象编程是一种编程范式，涉及将我们的程序理解为相互交互的对象集合。

现在大多数编程语言都有面向对象的组件，例如类和接口，因为它使得封装信息和行为变得非常容易。

示例：Java、C#

在面向对象的编程中，使用类属性也可以使函数引用不透明。例如，考虑以下代码：



![由 QuickLaTeX.com 呈现](https://www.baeldung.com/wp-content/ql-cache/quicklatex.com-dedcc915378405fc6e51af8e1199ae4f_l3.svg)



在面向对象的语言中，函数可以在类内部声明，在这种情况下它们被称为方法。

add 方法依赖于存储在类属性 a 和 b 中的值，这些值可以被类的任何其他方法修改。因此，add 方法是引用不透明的。

### 3.3. 函数式编程

最后，函数式编程是一种范式，涉及将我们的程序理解为数学意义上的函数组合。

函数式语言实际上对它们的(几乎)所有函数都实施了参照透明性。 这种严格的限制被透明函数带来的许多优势所抵消，我们将在下一节中详细介绍。

示例：Haskell、Lisp下面是一个 Haskell 示例，它说明了函数式程序的典型外观：





![由 QuickLaTeX.com 呈现](https://www.baeldung.com/wp-content/ql-cache/quicklatex.com-b8f6512be7c34a3f7e474ac462af0e4b_l3.svg)



main函数是唯一引用不透明的函数，所有其他函数在设计上都是引用透明的。



## 4.用例 

让我们退后一步，比较一下引用透明函数与泛型函数的区别。

首先，它将始终为一组特定的参数返回相同的输出值，而与调用它的时刻无关。其次，它不会与它之外的任何值交互，因此它不会从其他变量读取或写入信息。

### 4.1. 缓存

缓存是将函数结果存储在内存中以便将来更快检索的机制。 


如果一个函数是引用透明的，那么我们可以在第一次调用时保存它的输出，对于后续的每次调用，我们只需要进行一次内存查找。因此，函数的计算越复杂，我们节省的时间就越多。

### 4.2. 并行化

现代 CPU 内置多个内核，允许我们同时运行多个线程。

如果一个函数是引用透明的，那么我们可以运行它的多个副本而无需它们彼此交互：

![并行化](https://www.baeldung.com/wp-content/uploads/sites/4/2023/02/parallelization.png)

### 4.3. 流水线

大多数程序比简单的函数调用要长。它们是给定输入上的一系列函数应用程序。出于这个原因，我们不能以任何顺序并行化所有函数——我们仍然必须保持它们之间的逻辑依赖关系。

然而，我们可以做的是以重叠的方式在不同输入上运行函数序列。

如果我们的 5 步管道中的函数都是引用透明的，我们可以在输入 x1 上运行 f5 函数之前，在第二个输入 x2 上运行 f1 函数。换句话说，我们不必在开始第二个管道之前等待管道完成：



![管道](https://www.baeldung.com/wp-content/uploads/sites/4/2023/02/pipeline.png)

另一方面，如果某些函数是引用不透明的，则它们可能具有隐藏的依赖关系。在这种情况下，我们不能保证在另一个输入上启动第二个管道不会影响第一个管道的输出。

## 5.总结

总之，引用透明性是函数的一个属性，允许它被等效的输出替换。这是程序优化的理想属性，通过避免使用全局或共享状态来实现，因此将所有必需的信息作为参数传递。

在本文中，我们通过不同的编程范例(包括实际执行它的函数式范例)的镜头看到了引用透明性是如何出现的。
## 1. 概述

在本教程中，我们将讨论评论。我们将介绍两个类别。接下来，我们将看一些正确和不正确的例子。首先，我们还将研究替代方案。

## 2.不同类型

使用注释的第一个原因是记录 API。在 Java 中，它称为[Javadoc](https://www.baeldung.com/javadoc)，在 PHP Docblock 和 C# 中称为“XML 文档注释”。

它们描述了应该如何使用 API。我们必须意识到我们 API 的用户可能无法访问我们的源代码。因此，文档描述了预期的输入和输出。此外，它还应该解释用户应该预料到的异常和错误。文档应该清晰、完整和明确。

其他评论集中在我们项目的开发人员身上。例如，他们解释了开发决策。或者记录一个必须在未来版本中修复的问题。本文的其余部分将重点关注那些面向内部开发人员的评论。

## 3. 目标

在上一节中，我们已经强调了评论是针对开发者的。对于常规商业项目，这可能包括其生命周期内的广泛个人。也就是说，从初级开发人员到非常有经验的开发人员，以及来自不同文化背景的人。我们在撰写评论时应始终牢记这一点。

理想情况下，我们的代码应该是不言自明的，我们甚至不需要任何注释。然而，有时候纯粹使用代码是无法表达某些东西的。请参阅以下包含评论和正则表达式的片段：

```java
// Matches a Dutch zipcode, eg, '1974 XA' or '4844RA'
Pattern DUTCH_ZIPCODE = Pattern.compile("[1-9][0-9]{3} ?[A-Z]{2}");
```

如果没有注释，正则表达式对于有正则表达式经验的开发人员或来自荷兰的人来说仍然很清楚。然而，对于法国初级开发人员来说，这个正则表达式加上这个注释会更有意义。

## 4.缺点

注释在编写时大多是正确的。然而，代码是动态的，代码很可能迟早会发生变化。我们可能会因为改变了业务逻辑而改变代码。然而，测试并不能验证我们的评论。我们是否也更新了它们？我们是否将注释与代码一起移动了？还是评论变成了孤儿？

所以最大的缺点是注释并不总是倾向于跟随代码的变化。有时人们甚至可能将新代码放在代码和注释之间。有时我们更改代码而忘记更新注释。因此，这些评论可能会开始误导我们。

另一个问题是很多项目都有需要评论的指南。然而，没有信息的评论只会训练我们的大脑将它们过滤掉。因此增加了我们未能在需要时更新这些评论的风险。

由于这些缺点，我们应该总是更喜欢不言自明的代码而不是注释。然后评论可以是一个例外。而且，当它们更新时，我们可能会记得让它们保持最新状态。

## 5. 使用不当

对于哪些评论有用，哪些没有用，不同的人有不同的看法。我们尽最大努力将一些普遍认为不太有用的评论归为一组。我们还解释了一些替代方案。

### 5.1. 显而易见

不需要评论的一个很好的例子是陈述显而易见的事情。让我们看一下下面的片段：

```java
// numeric session-id
int sessionId = 0;
 
// expiry date
Date expiry = new Date();
```

上面的评论很明显，我们最好将它们排除在外。

然而，下一个片段中的评论更危险：

```java
// numeric session-id
int sessionTimeoutInSeconds = 3600;
```

我们可能从上一个示例的第 1 行了它。但是，由于我们未能对其进行更新，评论现在提供的是混淆而不是实际信息或上下文。

最后，示例中的注释解释了代码的作用：

```java
// resets session-id to 99;
function reset() {
    sessionId = 99;
}
```

但是，我们也可以不加评论地理解它。更新时我们可能会忘记更新评论，所以最好不要写评论。

### 5.2. 解释不清晰的代码

之前，我们已经讨论过我们更喜欢不言自明的代码。例如，通过为变量和方法使用精心挑选的名称。或者通过将一些代码提取到适当命名的变量或方法中以使其更具可读性。例如，请参阅我们曾经审查过的这段代码：

```java
int timeout = 5; // timeout in seconds
```

不幸的是，注释只会在这一行可见，而不会在使用变量的地方可见。当我们更新名称时，我们可以去掉注释并为我们使用此超时的每个地方明确单位：

```java
int timeoutInSeconds = 5;
```

有时，我们也倾向于通过以下方式记录复杂的 if 语句：

```java
// if during work hours
if (currentTime.hours >= 9 && currentTime.hours <= 17)
```

稍微重写这段代码既可以提高代码的可读性，也可以使注释过时：

```java
if (isDuringWorkingHours(currentTime))
```

我们已经看到，有时对代码的小改进可能会使注释过时。并且，同时提高了代码的可读性。

### 5.3. 未能利用版本控制系统

当前版本控制系统(VCS，例如 git、SVN、CVS)的使用使得一组示例过时了：

```java
// MvW 2020-08-20 Added method to validate working hours
function isDuringWorkingHours() {
...
}

// code below became obsolete on 2020-08-20
// function isAfterWorkingHours() {
// ...
// }
```

VCS 跟踪上述所有示例。我们宁愿删除旧代码。此外，没有理由在源文件中跟踪历史记录。只需确保使用正确的提交消息即可。

我们查看了一些示例和可能的改进。在下一节中，我们将建议一些正确的注释用法。

## 6. 正确使用

在前面的部分中，我们解释了当单独的编程语言不足以表达我们自己时应该使用注释。在接下来的部分中，我们将看到一些单靠语言本身无法表达的场景。

### 6.1. 法律义务

出于法律原因，可能希望所有文件都以版权标题为前缀。当需要或希望这样做时，绝对没有理由不包含它。好处还在于此注释未链接到代码的实际逻辑。在不需要更新代码的同时更新它，我们的大脑可能会过滤掉它。它很可能也会被我们的 IDE 隐藏。

### 6.2. 注释任务或已知缺陷

有时我们可能知道应该更改某些内容，但是，还没有时间去做。然后，添加TODO或FIXME注释可能是有意义的。这将使其他人清楚地知道有一个任务待处理。我们的 IDE 可能能够跟踪并列出所有这些。但是，当我们的项目使用 JIRA 等问题跟踪器时，我们应该始终将评论链接到积压工作中的任务：

```java
// FIXME CS-122 the method below fails in leap years
function isAfterWorkingHours() {
    ...
}
```

### 6.3. 重要代码

如前所述，开发人员可能具有不同的经验水平。因此，当使用更复杂的代码结构(例如正则表达式或日期解析器)时。解释预期的行为是有意义的。

一个例子可能是我们在第 3 节中展示的正则表达式的解释。另外，请注意，这样的解释在代码审查期间有很大帮助。但是，我们应该确保解释与逻辑保持一致。

### 6.4. 解释为什么

一种非常有用的注释类型解释了为什么代码是这样的。有时仅靠清晰的命名可能还不够，确实需要一些上下文：

```java
int resultCode = ...;
boolean isSucess = resultCode == 200;
boolean isTemporaryError = resultCode == 503 || resultCode == 504;
// Sometime we receive a temporary error. 
// However, in all cases which were researched, results were successfully stored.
// Because of this we will return true in that case.
return (isSucess || isTemporaryError);
```

这些评论也可能是一个警告。因为代码可能看起来不对或容易改进。但是，类可能不是线程安全的，将字段提取到变量会破坏应用程序。或者可能部署了解决方法，因为用户遇到了问题。一个具体的例子可能是多次(重新)引入的问题，因为影响不会直接显示：

```java
// Don't rewrite this to try-with-resources because that will
// auto-close the socket. The socket is needed every 15 minutes so the 
// error might not show directly but this will break the application
try {
    ... open a socket
} catch (IOException e) {
    ... handle error
}
```

## 七、总结

在本文中，我们查看了各种评论示例。我们查看了一些我们应该避免的以及一些其他示例，其中评论是最好的解决方案。

最重要的一点是，只添加有用的评论可能更容易使它们保持最新状态。
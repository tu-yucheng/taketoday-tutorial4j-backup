## 1. 概述

大多数现代 Web 应用程序都以某种形式使用会话。为了改善用户体验，会话通常用于存储有关客户端的信息：身份验证、定制推荐、购物车等。

同时，许多应用程序都是使用[RESTful 原则](https://www.baeldung.com/cs/rest-vs-http)构建的。在本教程中，我们将仔细研究定义会话的内容以及会话是否违反 RESTfulness 原则。

## 2.什么是会话？

术语会话在编程世界中具有多种含义。在最低级别，它可以指控制两个设备之间连接的[TCP](https://www.baeldung.com/cs/udp-vs-tcp)连接。

对于应用程序，会话只是一种跟踪与同一客户端的多次交互的状态的方法。虽然许多现代应用程序都使用 HTTP 进行访问，但该协议本身是无状态的。这意味着应用程序必须自己实现某种形式的会话管理。

会话跟踪通常涉及在每个客户端第一次发出请求时为其分配一个唯一标识符。然后，客户端在发送给服务器的任何后续请求中包含该 ID。在服务器端，标识符可用于保存和查找有关该客户端的详细信息。

### 2.1. 会话的典型用途

在现代 Web 应用程序中很难避免[会话状态。](https://www.baeldung.com/spring-session)这是因为会话启用了许多可以改善网站用户体验的功能：

-   记住用户的登录状态
-   跨多个设备存储购物车的内容
-   在不同的站点搜索中调用搜索过滤器

所有这些都需要服务器存储先前与客户端交互的详细信息。并且由于客户端可以更改(不同的设备、Web 浏览器等)，唯一一致的存储此状态的地方是在服务器上。

### 2.2. 饼干

请务必注意，会话与 cookie 不同。Cookie 只是一种用于在客户端和服务器之间交换会话信息的机制。但 cookie 不是唯一的方式，也不仅仅用于跟踪会话。

我们还可以使用自定义标头、查询参数或任意数量的其他 HTTP 功能来实现相同的结果。

## 3. REST 和状态

[REST](https://www.baeldung.com/cs/rest-vs-soap)代表代表性状态转移。[这是Roy Fielding 在他的论文](https://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm)中描述的一种架构风格，他在论文中描述了一种用于构建大型、可扩展的客户端-服务器系统的理想软件架构。

重要的是要注意，在 REST 的上下文中，术语状态有些过载。我们关心两种状态：

-   特定客户端-服务器交互的状态
-   资源状况

当我们谈论会话时，我们通常谈论的是前者。客户端和服务器之间的交互状态通常是我们谈论会话状态或会话时的意思。

另一方面，资源的状态始终由服务器维护。客户端可以请求不同的表示，或者他们可以发送对资源的修改。但服务器最终负责维护资源状态。

### 3.1. 无状态约束

在 RESTful 系统的众多限制中，每个请求都必须包含服务器完成此请求所需的所有信息。换句话说，从客户端到服务器的每个请求都不能依赖于任何先前请求的知识。

具体来说，以下是 Fielding 所说的关于 RESTful 系统的会话状态：

>   从客户端到服务器的每个请求都必须包含理解请求所需的所有信息，并且不能利用服务器上存储的任何上下文。因此，会话状态完全保存在客户端上。

请注意 Fielding 如何区分客户端状态和服务器状态。服务器可以而且应该管理资源的状态。例如，员工的地址或用户的订单历史记录。所有这些状态都与资源相关联，最终由服务器负责。

但是，客户端可以管理自己的状态。客户端可以存储他们认为合适的任何数据，例如用户名和密码、页面历史等。无状态的关键是确保从客户端到服务器的每个请求都具有完成请求所需的所有数据。

### 3.2. 无国籍的重要性

Fielding 在定义 REST 时包含无状态约束的原因有很多。首先，无状态系统更容易扩展。

考虑部署到多个服务器的应用程序。我们在不同的服务器上启动多个实例，用户通过负载均衡器访问它们。如果应用程序的每个实例都是真正无状态的，那么任何客户端都可以随时连接到任何实例。这使得负载平衡器的工作更加容易，因为它可以在决定向何处发送请求时利用任何可用的实例。我们还可以随时相对轻松地添加新实例。

但是，如果每个实例都为其交互的每个客户端维护一个会话状态，那么负载均衡器就不能简单地将任何请求路由到任何实例。相反，它必须确保具有已建立会话的客户端继续使用相同的实例。

这意味着负载均衡器必须检查每个请求并对应用程序本身有一定的了解。或者，我们可以创建一些共享上下文，其中每个应用程序实例都与所有其他实例共享其状态。这通常是使用一些分布式缓存或数据存储来完成的。

这两种方法都增加了系统的复杂性。它们会创建新的故障点，还会在组件之间创建原本不会存在的耦合。

除了可扩展性之外，无状态约束还为应用程序带来了其他令人满意的品质。例如，我们可以更好地了解系统，因为每个请求都可以被隔离地监控和观察。

我们还获得了更容易恢复的更可靠的系统。当一个实例失败时，我们只需重新启动它或添加另一个实例。我们不需要担心前一个实例正在维护的任何状态。

## 4. 会话是否违反 RESTfulness？

我们现在准备回答这个问题：会话是否违反了 RESTfulness？让我们回顾一下之前的 2 条关键信息：

-   会话存储在服务器上
-   RESTful 约束规定会话只能由客户端存储

从这个意义上说，会话确实违反了 RESTfulness。但这不一定是坏事。与软件开发中的大多数决策一样，我们正在做出权衡。

通过牺牲无状态性，我们正在实现更有意义的用户体验。我们可以在手机上将商品添加到购物车，然后在笔记本电脑上完成交易。我们可以登录一次网站，并获得针对我们自己的过滤器或设置量身定制的页面的自定义视图。

## 5.总结

在本文中，我们了解了会话到底是什么，以及会话是否违反 RESTfulness。存储在服务器上的任何会话状态都违反了 REST 的关键原则之一，即状态只能由客户端存储。

虽然这可能会使我们的应用程序不符合其原始定义的 RESTful，但这是一个可能值得做出的权衡。每个应用程序都是不同的，并且会有不同的要求。通过放弃 REST 的一些限制，我们可以实现不同的用户体验。
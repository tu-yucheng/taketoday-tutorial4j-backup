## 1. 概述

在本教程中，我们将了解什么是代码覆盖率、如何衡量它以及它如何提高开发软件的质量。

代码覆盖率描述了自动化测试覆盖的代码百分比。换句话说，它检查代码的哪些部分在测试套件期间运行，哪些不运行。

## 2. 代码覆盖率的重要性

软件开发过程的主要目标是创建满足我们要求的高质量、无故障的应用程序。

该过程的关键部分之一是测试。单元测试的最大好处是它们可以保护已经实现的功能不因代码更改而被破坏。此外，单元测试让开发人员有一种保护应用程序免受错误影响的感觉。

但是，这一切真的是真的吗？

首先，我们不能说实施单元测试可以为我们的应用程序提供可靠的 bug 保护，除非我们使用代码覆盖 方法。代码覆盖率是我们用来量化我们的单元测试达到了多少基于代码的指标。

创建单元测试并不确定它们是否至少涵盖了最重要的场景、路径和边缘情况似乎是一个无利可图的想法。代码覆盖率为开发人员提供了有关代码的哪些部分未经过测试的关键信息，因此可能会导致错误或遗漏需求。

其次，从项目一开始就采用代码覆盖方法可以消除开发生命周期早期阶段可能出现的错误。因此，我们可能会承担更少的技术债务。

第三，上述所有优点都缩短了开发和维护时间。从商业角度来看，所有这些都带来了更好的投资回报率。它还可以通过减少 UAT 和生产问题来提高客户满意度。

正如我们所看到的，使用代码覆盖率在各个阶段改进了软件开发过程并满足了所有利益群体。

在下一节中，我们将看到衡量代码覆盖率的最常用方法。

## 3. 衡量代码覆盖率的方法

### 3.1. 报表覆盖率

语句覆盖的主要目的是将程序代码中的每个可执行语句至少运行一次。它通常也称为线覆盖。

那么，让我们定义什么是语句。语句是命令式编程语言中表示某些操作的最小单元。

语句覆盖率的百分比可以计算为：

语句覆盖率=执行语句数/语句总数100

这种衡量代码覆盖率的方法能够：

-   验证编写代码的注意事项
-   查找死代码和未使用的语句
-   测试不同的流路并检查哪些没有被覆盖

我们来分析一个简单的例子。下面我们给出了程序的伪代码，该程序对两个数字求和并在结果小于、大于或等于零时打印信息：

![由 QuickLaTeX.com 呈现](https://www.baeldung.com/wp-content/ql-cache/quicklatex.com-f7eaa2c205aa7e5ad2b0922f40364e05_l3.svg)

现在，让我们谈谈可能的测试。在第一个选项中，我们给出了 a = 3，b = 5。第 1、2、3 和 4 行的语句将在此测试用例中执行。所以我们涵盖了八个陈述中的四个。这意味着我们的报表覆盖率等于 50%。

让我们讨论另一个选项 a = 3, b = -5。在此场景中，将执行第 1、2、3、5、6 行的语句。两个测试都调用了第 1 – 6 行。总代码覆盖率等于(6/8)  100 = 75%。

### 3.2. 分支机构覆盖

分支覆盖确保决策树中的每个决策是否至少执行一次。我们所说的分支是指：条件语句、循环、switch 语句。我们可以使用以下公式计算分支覆盖率：

分支覆盖率=执行的分支数/总分支数100

分支机构覆盖的优势：

-   验证测试套件的执行是否到达所有分支
-   检测每个分支可能的异常行为
-   可以测试其他方法可能忽略的源代码区域

下面给出的伪代码表示一个程序，它打印通过的数字，如果数字是偶数，还打印附加注释：

![由 QuickLaTeX.com 呈现](https://www.baeldung.com/wp-content/ql-cache/quicklatex.com-9ad1dd309d37b2d4808905301088e3fa_l3.svg)

下面我们可以看到说明上述算法的流程图：

[![甚至](https://www.baeldung.com/wp-content/uploads/sites/4/2020/03/even.svg)](https://www.baeldung.com/wp-content/uploads/sites/4/2020/03/even.svg)

我们可以在图中看到三个箭头。这些是给定程序的分支。其中两个用“是”和“否”来描述的分支称为条件分支。没有标签的箭头是无条件分支。分支覆盖范围考虑了这两种类型。

现在让我们探讨两个测试场景：

1.  给定 a = 1。测试用例将仅通过标记为“否”的分支。分支覆盖率：1/3  100 = 33%。
2.  给定 a = 4。测试用例将通过标记为“是”的分支和无条件分支。分支覆盖率：2/3  100 = 67%

显然，这两个测试一起覆盖了 100% 的分支。

### 3.3. 功能覆盖

函数覆盖验证程序的每个函数是否至少被调用一次。测试具有不同输入参数的函数也很重要。这样，测试套件还将检查函数在不同场景中的行为是否正确。

要计算函数覆盖率，我们可以使用以下公式：

函数覆盖率=执行函数数/函数总数100

与其他功能相比，功能覆盖范围最广。

比方说，我们的应用程序只包含一个方法。为该方法实施单个单元测试将导致 100% 的功能覆盖率。显然，一个单元测试无法覆盖所有的路径和场景。尽管 100% 的功能覆盖率，我们的应用程序显然没有经过充分测试。

正如我们所见，高百分比的代码覆盖率并不总是意味着代码是理想的和无故障的。

我们将在下一节中讨论该主题。

## 4.目标覆盖率是多少？

这个问题的答案似乎显而易见。大多数情况下，首先想到的是我们应该尽可能接近 100%，这样我们的软件就会接近完美。事实证明事情并没有那么简单。

首先，这取决于当前的项目状态。如果我们从软件开发一开始就测量代码覆盖率，覆盖率可能会超过 90%，这是一个很好的结果。特别是如果我们使用 TDD 方法。

在一个大型遗留项目中通过很少或没有测试实现相同的代码覆盖率几乎是不可能的。对于这种情况，最好的方法是为新功能创建测试，然后在修改、修复或扩展它们的同时用测试覆盖现有功能。因此，人们可以想象甚至 30% 作为他们遗留项目的成功。

其次，强制执行 100% 的代码覆盖率本身不应该是目标。它甚至可能对软件质量有害。开发人员通常会为了达到目标而编写无用或误导的测试。这种行为可能会导致遗漏甚至错误地实现需求，因为开发人员将更专注于尽可能多地覆盖代码，而不是有效的业务逻辑本身。

最后，在上一节中，我们注意到 100% 的代码覆盖率并不意味着代码中没有错误。这取决于所选的代码覆盖率指标。除此之外，这些功能可能完美无缺并且经过良好测试，但它们可能无法按预期工作。验证域错误是代码覆盖率可能无法处理的事情。

代码覆盖率是一个有用的工具，但我们不应将其视为主要目标。我们应该通过为按要求实现的功能创建高质量、有意义的测试来关注我们的代码质量。

## 5.代码覆盖工具

在本节中，我们将简要介绍一些常见编程语言的代码覆盖工具。

### 5.1. 雅可可

[JaCoCo](https://www.baeldung.com/jacoco)是 Java 开发人员的绝佳工具。它是 Eclipse 基金会的一部分。它可以轻松地与最重要的框架集成，例如 Gradle、Maven、IntelliJ IDEA、Eclipse 等等。JaCoCo 生成强大而详细的代码覆盖率报告。此外，作为一个开源工具，它对个人和商业用途都是免费的。

### 5.2. 伊斯坦布尔

Javascript 开发人员可以使用名为 Istambul 的便捷工具。它支持 ES5 和 ES2015+。Istambul 可以与各种单元测试框架集成，例如 tap、mocha 或 AVA。输出在终端或 HTML 中提供。就像 JaCoCo 是开源的一样，可以免费用于个人和商业目的。

更多信息可以在[Istambul 的官方网站上](https://istanbul.js.org/)找到。

### 5.3. Coverage.py

Python 开发人员可以使用 Coverage.py。它作为 API 从命令行运行，或者可以与测试运行器集成。Coverage.py 是开源的，对所有用例都是免费的。

我们可以访问[Coverage.py 的网站](https://coverage.readthedocs.io/)了解更多详情。

### 5.4. 覆盖

[NCover](https://www.ncover.com/)为.NET 平台提供企业代码覆盖率解决方案。它主要是为团队和组织设计的。它允许开发人员和 QA 团队使用协作功能进行合作。NCover 是一种高级、强大的企业工具，不适合用于个人目的。因此，它既不是免费的也不是开源的。

## 六，总结

在本文中，我们定义了代码覆盖术语的含义，并分析了各种衡量它的方法。此外，我们还讨论了为什么代码覆盖率在软件开发过程中很重要，以及我们应该设定多少代码覆盖率。此外，还引入了一些代码覆盖工具。

最后，请记住，100% 的代码覆盖率不应像一种必然的趋势那样盲目追随。关注测试的质量而不是数量，并根据要求实施功能。